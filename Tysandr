[{"name":"TIMEOUT","type":"trigger","patterns":["^You will TIMEOUT in 1 minute unless you do something\\.$"],"output":" Core.send(\"p nothing\")","id":"QO-ouj0sv"},{"name":"Notes for Reference System","type":"script","id":"QO-2u69wu","output":"/*\nYou have smoked the last traces of skullcap in a simple oaken pipe.\n\n Modules defined:\n \n > Self/System\n   >> References the system and performs meta tasks\n   >> Handles initial GMCP routing\n   >> Includes:\n      - performance manager\n      - remote data manager\n      - debugging\n      - timing\n      - logging protocol\n      - trigger manager\n      - keybinds\n      \n > Window Management\n   >> Defines a UI interface & manager\n   >> Includes a chat-window\n   >> Color palette\n \n > Player\n   >> Defines the player-character and information regarding him/her\n   \n > DB\n   >> Defines a set of databases for use by other Modules\n   >> Includes a PDB\n   \n > Mapper\n   \n > Combat\n   >> defense\n   >> parry\n   >> hydra\n   >> assault\n   >> logging subprotocol\n   >> group-fighting\n\n > Bashing\n\n */"},{"name":"System","type":"folder","id":"QO-5rr6sk","desc":"","is_open":false,"output":"/*\n > Self/System\n   >> References the system and performs meta tasks\n   >> Handles initial GMCP routing\n   >> Includes:\n       [ ] performance manager\n       [ ] remote data manager\n       [ ] debugging\n       [ ] timing\n       [-] window manager\n       [ ] logging protocol\n       [x] trigger manager\n       [ ] keybinds\n       [ ] color manager\n       \n */","children":[{"name":"utility","type":"folder","id":"QO-1mn29y","desc":"","is_open":false,"children":[{"name":"`js, Execute Javascript","type":"alias","patterns":["^`js[ ]+(.*)$"],"output":"try {\n  var x = eval(matches[1])\n  display(x)\n  console.log(x)\n} catch(err) {\n  display(err)\n  console.log(err)\n}","id":"QO-twaae2"},{"name":"http.link","type":"trigger","patterns":["^[\\S\\s]*([Hh]ttps?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)?)[\\S\\s]*$"],"output":" Triggers.ignore(true)\n var url = matches[1]\n sub({\n   method: 'inline-substitution',\n   target: url,\n   output: '<a href=\"' + url + '\" target=\"_blank\">' + url + '</a>'\n })","id":"QO-l1za3h"}]},{"name":"meta","type":"script","id":"QO-fki0wz","output":"meta = typeof meta != 'undefined' ? meta : {}\n\n"},{"name":"meta.gmcpEvents","type":"script","id":"QO-m9m159","output":"/*\n  all gmcp events should be routed through here,\n  insert a pointer to help you structure your code, i.e.\n  \n  >  on GMCP\n  >>   player.gmcp()\n  >>   mapper.gmcp()\n  \n */\n \nmeta = typeof meta != 'undefined' ? meta : {}\n\nmeta.gmcpEvents = function() {\n  $('body')\n    .off('gmcp')\n    .on('gmcp', function(e,data){\n      // console.log(data)\n     \n      // Your module specific gmcp goes here\n    \n      // Pass-through all\n      if (typeof player != 'undefined' && typeof player._gmcp == 'function') { player._gmcp(data) }\n      if (typeof pdb != 'undefined' && typeof pdb._gmcp == 'function') { pdb._gmcp(data) }\n      if (typeof cb != 'undefined' && typeof cb._gmcp == 'function') { cb._gmcp(data) }\n      if (typeof bash != 'undefined' && typeof bash._gmcp == 'function') { bash._gmcp(data) }\n      \n      // Selective pass-through\n      if (data.key == 'Comm.Channel.Text') {\n        if (typeof chat != 'undefined' && typeof chat._gmcp == 'function') { chat._gmcp(data) }\n      }\n    \n    })\n}\n\nmeta.gmcpEvents()"},{"name":"meta.dataManager","type":"folder","id":"QO-47ql8y","desc":"","is_open":false,"children":[{"name":"meta.local","type":"script","id":"QO-0tnrvg","output":"meta = typeof meta != 'undefined' ? meta : {}\n\nmeta.local = (function() {\n  let write = function(key,data) {\n    let v = JSON.stringify(data)\n    localStorage.setItem(key, v)\n  }\n  \n  let read = function(key) {\n    let v = localStorage.getItem(key)\n    if (!v) { return false }\n    return JSON.parse(v)\n  }\n\n  return {\n    read: read,\n    write: write,\n  }\n})()"}]},{"name":"svw, subviews","type":"folder","id":"QO-jlabyg","desc":"","is_open":true,"children":[{"name":"svw, subviews","type":"script","id":"QO-6eynsf","output":"svw = typeof svw != 'undefined' ? svw : {} // subviews\n\nsvw.registry = typeof svw.registry != 'undefined' ? svw.registry : []\n\nsvw.wipe = function() {\n  \n}\n\nsvw.retrieve = function(name) {\n  for (var k = 0; k < svw.registry.length; k++) {\n    var item = svw.registry[k]\n    for (var key in item) {\n      if (key == name) {\n        return item[key]\n      }\n    }\n  }\n  return false\n}\n\nsvw.update = function() {\n  \n}\n\nsvw.sweep = function() {\n\n}"},{"name":"svw, CSS","type":"script","id":"QO-i76hr8","output":"svw = typeof svw != 'undefined' ? svw : {} // subviews\n\nsvw.className = 'svw-class'\n\nsvw.defaultRules = `\n .svw-window {\n   position: absolute;\n   left    : 8%;\n   top     : 4px;\n   height  : 155px;\n   width   : 255px;\n   \n   border  : 1px solid rgb(155,155,155);\n   background: url('./core/resources/raster.png');\n }\n`\n\nsvw.inject = function(rule) {\n  if (!rule) { return }\n  $('body').append('<div class=\"' + svw.className + '\">&shy;<style>' + rule + '</style></div>')\n}\n\nsvw.css = function() {\n  if ($('.' + svw.className).length) { $('.' + svw.className).remove() }\n  svw.inject(svw.defaultRules)\n}\n\nsvw.css()"},{"name":"svw, API","type":"script","id":"QO-jgt3yo","output":"svw = typeof svw != 'undefined' ? svw : {} // subviews\n\nsvw.memberClass = 'svw-window'\nsvw.defaultContainer = 'body'\n\nsvw.make = function(name, options) {\n  var str = ''\n  str += '<div id=\"svw-' + name + '\" class=\"' + name + ' ' + svw.memberClass + '\">'\n  str += '</div>'\n  \n  let location;\n  let opts = options || {};\n  \n  location = opts.location ? opts.location : svw.defaultContainer\n    \n  if (opts.css) {\n    // wipe previous references\n    // write new CSS rules for this window\n  }\n  \n  $(location).append(str)\n  \n  // register it\n  svw.registry.push({[name]: $('#svw-' + name)})\n}\n\nsvw.delete = function(name) {\n  let forRemoval = []\n  for (var j = svw.registry.length - 1; j > -1; --j) {\n    for (const [key, ref] of Object.entries(svw.registry[j])) {\n      if (key == name) {\n        ref.remove()\n        forRemoval.push(j)\n      }\n    }\n  }\n  for (var k = 0, len = forRemoval.length; k < len; k++) {\n    svw.registry.splice(forRemoval[k], 1)\n  }\n}\n\nsvw.reset = function(name) {\n  \n}\n\nsvw.position = function(name, x, y, z) {\n  \n}\n\nsvw.resize = function(name, w, h) {\n  \n}"}]},{"name":"meta.triggers","type":"folder","id":"QO-nc69of","desc":"","is_open":false,"output":"/*\n  trigger management\n  >> `tr .* to display triggers (using a search term, if desired)\n  \n */","children":[{"name":"`tr, triggers list","type":"alias","id":"QO-wwwjfu","patterns":["^`tr([ ]+?.+?)*$"],"output":"meta.triggers.list(matches[1] ? matches[1].trim() : undefined)"},{"name":"meta.triggers","type":"script","id":"QO-5wl8xd","output":"meta = typeof meta != 'undefined' ? meta : {}\n\nmeta.triggers = (function(){\n  // filter & display\n  let list = function(str) {\n    let rpad = Utilities.rpad\n    let lpad = Utilities.lpad\n    let C = Utilities.clone\n    let T = Triggers.list\n    let prefix = Client.prefix\n    \n    let U = []\n    let B = 0\n    for (var j = 0, len = T.length; j < len; j++) {\n      var trigger = T[j]\n      var tr;\n      if (str) {\n        if (trigger.pattern.match(str)) {\n          tr = C(trigger)\n          tr.id = j\n          U.push(tr)\n        } else if (trigger.name.match(str)) {\n          tr = C(trigger)\n          tr.id = j\n          U.push(tr)\n        }\n      } else {\n        tr = C(trigger)\n        tr.id = j\n        U.push(tr)\n      }\n    }\n    let out = ''\n    for (var k = 0, leng = U.length; k < leng; k++) {\n      var trig = U[k]\n      var s = ''\n      s += '<span class=\"mute\">' \n      s += '<span class=\"mute ' + (trig.uuid ? trig.uuid : '') + '\">' + lpad(trig.id, 5) + '</span> '\n      s += '<span class=\"deepblack\">&compfn;</span> '\n      s += '<span class=\"bal \">' + rpad(trig.name.substring(0, 17), 18) + '</span>: '\n      s += '<span class=\"mute\">' + trig.pattern + '</span>'\n      s += '</span>\\n'\n      s = prefix(s) + s\n      out += s\n    }\n    let a;\n    if (str) {\n        a = '==== Trigger search (<span class=\"normal\">' + str + '</span>) '\n    } else {\n        a = '==== Triggers '\n    }\n    a = '<span class=\"black\">' + rpad(a, 91, '=') + '</span>'\n    out = prefix('') + '\\n' + prefix('') + a + '\\n' + out + prefix('') + '\\n'\n    Core.printdown(out)\n  }\n  \n  return {\n    list  : list,\n  }\n})()"}]}]},{"name":"Player","type":"folder","id":"QO-kkt7eh","desc":"","is_open":false,"children":[{"name":"player._init","type":"script","id":"QO-769tx1","output":"player = typeof player != 'undefined' ? player : {}\n\nplayer._init = function() {\n  player._body = $('body')\n}\n\nplayer._init()"},{"name":"player, gmcp routing","type":"script","id":"QO-sulvsh","output":"player = typeof player != 'undefined' ? player : {}\n\nplayer._gmcp = function(data) {\n  let datum = data.data\n  switch (data.key) {\n    case 'Char.Name':\n      break;\n      \n    case 'Char.Status':\n      player._handleStatus(datum)\n      break;\n      \n    case 'Char.Vitals':\n      player._handleVitals(datum)\n      break;\n    \n    case 'Char.Defences.List':\n      player._handleDefences(datum)\n      break;\n    \n    case 'Char.Defences.Add':\n      break;\n      \n    case 'Char.Items.List':\n      break;\n      \n    case 'IRE.Rift.List':\n      break;\n    \n    case 'IRE.Rift.Change':\n      break;\n      \n    case 'Char.Afflictions.List':\n      player._handleAfflictions(datum)\n      break;\n      \n    case 'Char.Afflictions.Add':\n      player._handleAfflictionsAdd(datum)\n      break;\n      \n    case 'Char.Afflictions.Remove':\n      player._handleAfflictionsRemove(datum)\n      break;\n      \n    case 'Comm.Channel.List':\n      break;\n  }\n}"},{"name":"player._handleVitals","type":"script","id":"QO-i7amsz","output":"player = typeof player != 'undefined' ? player : {}\n\nplayer._regexBleed = /Bleed\\: (\\d+)/i\nplayer._regexRage  = /Rage\\: (\\d+)/i\nplayer._regexSpirits = /Spirits\\: (\\d+)/i\n\nplayer._handleVitals = function(data) {\n  player.bal = data.bal ? parseInt(data.bal) : player.bal ? player.bal : 1\n  player.eq  = data.eq  ? parseInt(data.eq)  : player.eq  ? player.eq  : 1\n  player.hp  = data.hp  ? parseInt(data.hp)  : player.hp  ? player.hp  : 1\n  player.mp  = data.mp  ? parseInt(data.mp)  : player.mp  ? player.mp  : 1\n  \n  player.mhp = data.maxhp ? parseInt(data.maxhp) : player.mhp ? player.mhp : 1\n  player.mmp = data.maxmp ? parseInt(data.maxmp) : player.mmp ? player.mmp : 1\n  \n  if (data.charstats && data.charstats.length > 0) {\n    for (var j = 0, len = data.charstats.length; j < len; j++) {\n      let element = data.charstats[j]\n      let capture;\n      if (element.match(player._regexBleed)) {\n        capture = player._regexBleed.exec(element)\n        player.bleed = parseInt(capture[1])\n      } else if (element.match(player._regexRage)) {\n        capture = player._regexRage.exec(element)\n        player.rage  = parseInt(capture[1])\n      } else if (element.match(player._regexSpirits)) {\n        capture = player._regexSpirits.exec(element)\n        player.spirits = parseInt(capture[1])\n      }\n    }\n  }\n}"},{"name":"player._handleStatus","type":"script","id":"QO-x3em98","output":"player = typeof player != 'undefined' ? player : {}\n\nplayer._handleStatus = function(data) {\n  // Handle Name\n  let oldName = player.name\n  player.name = data.name ? data.name : player.name ? player.name : 'Unknown Player'\n  if (oldName != player.name) {\n    player._body.trigger('delta-name', player.name)\n  }\n  \n  player.race = data.race ? data.race : player.race ? player.race : 'Unknown Race'\n  \n  // Handle Class\n  let oldClass = player.class\n  player.class = data.class ? data.class : player.class ? player.class : 'Unknown Class'\n  if (oldClass != player.class) {\n    player._body.trigger('delta-class', player.class)\n  }\n  \n  // Handle Target\n  let oldTarget = player.target\n  player.target = data.target ? data.target : player.target ? player.target : 'None'\n  if (oldTarget != player.target) {\n    player._body.trigger('delta-target', player.target)\n  }\n}"},{"name":"player._handleDefences","type":"script","id":"QO-hclywx","output":"player._handleDefences = function(data) {\n  player.defences = []\n  for (var k = 0; k < data.length; k++) {\n    player.defences.push(data[k].name)\n  }\n}"},{"name":"player._handleAfflictions","type":"script","id":"QO-ikaazp","output":"player.affs = typeof player.affs != 'undefined' ? player.affs : {}\n\nplayer._handleAfflictions = function(data) {\n  player.affs = {}\n  for (var k = 0; k < data.length; k++) {\n    player.affs[data[k].name] = data[k]\n  }\n}\n\nplayer._handleAfflictionsAdd = function(data) {\n  player.affs[data.name] = data\n}\n\nplayer._handleAfflictionsRemove = function(data) {\n  delete player.affs[data.name]\n}"}]},{"name":"Player DB","type":"folder","id":"QO-ttkwt1","desc":"","is_open":false,"children":[{"name":"pdb","type":"script","id":"QO-frqv9o","output":"pdb = typeof pdb != 'undefined' ? pdb : {}\n\n_db = typeof _db != 'undefined' ? _db : {}\n\npdb.use  = true\npdb.flag = typeof pdb.flag != 'undefined' ? pdb.flag : false\npdb.capture = typeof pdb.capture != 'undefined' ? pdb.capture : []\n\npdb.retrieve = function() {\n  \n}\n\npdb.write = function() {\n    \n}\n\npdb.isPlayer = function(name) {\n  if (!_db[name]) { return false }\n  return _db[name]\n}\n\npdb.add = function(name) {\n  _db[name] = {\n    colorClass: 'pdb-Player',\n    colors: {\n      r: 18,\n      g: 219,\n      b: 179,\n    },\n    useColor: false,\n    regex: new RegExp('\\\\b' + name + '\\\\b'),\n  }\n}\n\npdb.remove = function(name) {\n  if (!_db[name]) { return false }\n  delete _db[name]\n  return true\n}\n\npdb.get = function(name, key) {\n  if (!_db[name]) { return false }\n  return _db[name]\n}\n\npdb.set = function(name, key, value) {\n  if (!_db[name]) { pdb.add(name) }\n  _db[name][key] = value\n  return true\n}\n\npdb.toggle = function(v) {\n  if (typeof v != 'undefined') {\n    pdb.use = v\n  } else {\n    if (pdb.use) { pdb.use = false } else { pdb.use = true }\n  }\n}"},{"name":"pdb, css-rules","type":"script","id":"QO-vciths","output":"pdb = typeof pdb != 'undefined' ? pdb : {}\n\npdb.className = 'pdb-rules'\n\npdb.inject = function(rule) {\n  if (!rule) { return }\n  $('body').append('<div class=\"' + pdb.className + '\">&shy;<style>' + rule + '</style></div>')\n}\n\npdb.css = function() {\n  let print  = Core.printdown\n  let prefix = Client.prefix\n  \n  $('.' + pdb.className).remove()\n \n  pdb.inject(`\n   .pdb-Player {\n     color: rgb(108, 108, 108);\n   }\n   .pdb-Ashtan {\n     color: rgb(163, 0, 133);\n   }\n   .pdb-Cyrene {\n     color: rgb(145, 145, 35);   \n   }\n   .pdb-Eleusis {\n     color: rgb(23, 173, 60);\n   }\n   .pdb-Hashan {\n     color: rgb(230, 127, 9);\n   }\n   .pdb-Mhaldor {\n     color: rgb(209, 4, 62);\n   }\n   .pdb-Targossas {\n     color: rgb(109, 194, 227);\n   }\n  `)\n  \n  var p   = '<span class=\"mute\">' + prefix() + '</span>'\n  var str = ''\n  str += p + '<span class=\"pdb-Player\">Rogue</span>\\n'\n  str += p + '<span class=\"pdb-Ashtan\">Ashtan</span>\\n'\n  str += p + '<span class=\"pdb-Cyrene\">Cyrene</span>\\n'\n  str += p + '<span class=\"pdb-Eleusis\">Eleusis</span>\\n'\n  str += p + '<span class=\"pdb-Hashan\">Hashan</span>\\n'\n  str += p + '<span class=\"pdb-Mhaldor\">Mhaldor</span>\\n'\n  str += p + '<span class=\"pdb-Targossas\">Targossas</span>\\n'\n  print(str)\n}\n\npdb.css()"},{"name":"pdb, gmcp routing","type":"script","id":"QO-w2m6k5","output":"pdb = typeof pdb != 'undefined' ? pdb : {}\n\npdb._gmcp = function(data) {\n  let datum = data.data\n  switch (data.key) {\n    case 'Char.Name':\n      pdb._apiQW()\n      break;\n      \n    case 'Room.Players':\n      pdb._handleRoomPlayers(data.data)\n      break;\n      \n    case 'Room.AddPlayer':\n      console.log(data)\n      pdb._handleRoomAddPlayer(data.data)\n      break;\n    \n    case 'Room.RemovePlayer':\n      console.log(data)\n      pdb._handleRoomRemovePlayer(data.data)\n      break;\n      \n    case 'Comm.Channel.List':\n      break;\n  }\n}"},{"name":"pdb, gmcpHandlers","type":"script","id":"QO-fof8f0","output":"pdb = typeof pdb != 'undefined' ? pdb : {}\n\npdb._handleRoomPlayers = function(data) {\n  for (var k = 0; k < data.length; k++) {\n    let name = data[k].name\n    if (!pdb.isPlayer(name)) {\n      pdb.add(name)\n    }\n  }\n}\n\npdb._handleRoomAddPlayer = function(data) {\n  if (!pdb.isPlayer(data.name)) {\n    pdb.add(data.name)\n  }\n}\n\npdb._handleRoomRemovePlayer = function(data) {\n  if (!pdb.isPlayer(data)) {\n    pdb.add(data)\n  }\n}"},{"name":"pdb, highlight","type":"script","id":"QO-powita","output":"pdb = typeof pdb != 'undefined' ? pdb : {}\n\npdb.highlight = function() {\n  if (!pdb.use) { return }\n  for (var name in _db) {\n    var k = _db[name]\n    sub(k.regex, '<span class=\"' + k.colorClass + '\">' + name + '</span>')\n  }\n}"},{"name":"pdb, achaea-api","type":"script","id":"QO-ny0euk","output":"pdb = typeof pdb != 'undefined' ? pdb : {}\n\npdb._apiQW = async function() {\n  let f = await $.getJSON('https://api.achaea.com/characters.json', function(data) {\n    return data\n  })\n  \n  let p = $.when(1)\n  if (f) {\n    let c = f.characters\n    let g = []\n    console.log('<pdb> Retrieving character JSONs. Please wait...')\n    c.forEach(function(e, index) {\n      p = p.then(function() {\n        return $.ajax({ url: e.uri })\n      }).then(function(data) {\n        g.push(data)\n      })\n    })\n    p = p.then(function(){\n      $('body').trigger('pdb-apiQueryComplete', [g])\n    })\n  }\n}\n\npdb._apiSetup = function() {\n  $('body')\n    .off('pdb-apiQueryComplete')\n    .on('pdb-apiQueryComplete', function(r,list){\n      console.log('<pdb> Processing data.')\n      list.forEach(function(data, index){\n        pdb.add(data.name)\n        pdb.set(data.name,'city',data.city.toProperCase())\n        if (data.city != '(none)' && data.city != '(hidden)') {\n          pdb.set(data.name,'colorClass','pdb-' + data.city.toProperCase())\n        }\n      })\n      console.log('<pdb> Processing complete.')\n    })\n}\n\npdb._apiSetup()"},{"name":"capture all","type":"trigger","id":"QO-v0mi8k","patterns":["^(.+?)$"],"output":"Triggers.ignore(true)\nif (typeof pdb.highlight == 'function') {\n  pdb.highlight()\n}"},{"name":"`pdb, grab API data","type":"alias","id":"QO-bpd7gm","patterns":["`pdb$"],"output":"pdb._apiQW()"},{"name":"`pdb on|off, toggle highlights","type":"alias","id":"QO-jqmeh0","patterns":["`pdb (on|off)$"],"output":"pdb.toggle(matches[1] == 'on' ? true : false)"}]},{"name":"Combat","type":"folder","id":"QO-rqobz9","desc":"","is_open":false,"output":"/*\n  \n  Requires \"player\", \"pdb\" module\n  \n */","children":[{"name":"cb, combat","type":"script","id":"QO-jgi0v2","output":"cb = typeof cb != 'undefined' ? cb : {}"},{"name":"cb, css-rules","type":"script","id":"QO-dfwl11","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb.className = 'combat-rules'\n\ncb.inject = function(rule) {\n  if (!rule) { return }\n  $('body').append('<div class=\"' + cb.className + '\">&shy;<style>' + rule + '</style></div>')\n}\n\ncb.css = function() {\n  $('.' + cb.className).remove()\n  \n  cb.inject(`\n  #selfwindow-nameplate {\n    position   : absolute;\n    bottom     : 0%;\n    width      : 100%;\n    margin-left: -2.3em;\n    direction  : rtl;\n    font-family: Lekton;\n    font-size  : 9pt;\n    color      : rgba(67,97,117,1);\n    line-height: 17px;\n  }\n  #selfwindow-afflictions {\n    position   : absolute;\n    bottom     : 24px;\n    width      : 100%;\n    margin-left: -0.3em;\n    direction  : rtl;\n    font-family: Lekton;\n    font-size  : 9pt;\n    color      : rgba(67,67,67,1);\n    line-height: 13px;\n  }\n  #selfwindow-afflictions div {\n    white-space: pre-wrap;\n  }\n  \n  #targetwindow-nameplate {\n    position   : absolute;\n    top        : 11px;\n    width      : 100%;\n    margin-left: -2.0em;\n    direction  : rtl;\n    font-family: Noto Sans, Lekton;\n    font-size  : 10pt;\n    color      : rgba(117,33,33,1);\n    line-height: 17px;\n  }\n  #targetwindow-afflictions {\n    position   : absolute;\n    top        : 35px;\n    width      : 100%;\n    margin-left: -0.3em;\n    direction  : rtl;\n    font-family: Lekton;\n    font-size  : 9pt;\n    color      : rgba(67,67,67,1);\n    line-height: 13px;\n  }\n  `)\n}\n\ncb.css()"},{"name":"cb, gmcp routing","type":"script","id":"QO-iwsefa","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb._gmcp = function(data) {\n  let datum = data.data\n  switch (data.key) {\n    case 'Char.Afflictions.List':\n    case 'Char.Afflictions.Add':\n    case 'Char.Afflictions.Remove':\n      cb._selfwindowUpdate()\n      break;\n    \n    case 'Char.Defences.List':\n      break;\n    \n    case 'Char.Defences.Add':\n      break;\n    \n    case 'Char.Defences.Remove':\n      break;\n\n   /*\n    case 'Char.Status':\n      break;\n      \n    case 'Char.Vitals':\n      break;\n      \n    case 'Char.Items.List':\n      break;\n      \n    case 'IRE.Rift.List':\n      break;\n    \n    case 'IRE.Rift.Change':\n      break;\n    */  \n    default:\n      break;\n  }\n}"},{"name":"cb, hydra","type":"script","id":"QO-ubnlc8","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb.hydra = typeof cb.hydra != 'undefined' ? cb.hydra : {}"},{"name":"cb, parry","type":"script","id":"QO-qmgx3p","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb.parry = typeof cb.parry != 'undefined' ? cb.parry : {}"},{"name":"cb, assault","type":"script","id":"QO-h7s9vy","output":""},{"name":"cb, combat views","type":"folder","id":"QO-0mo0vn","desc":"","is_open":false,"children":[{"name":"`cb, combat mode","type":"alias","id":"QO-0d7rdy","patterns":["^`cb$"],"output":"cb.subviews()"},{"name":"`ucb, uncombat mode","type":"alias","id":"QO-f56gu9","patterns":["`ucb$"],"output":"cb.unview()"},{"name":"cb, subviews","type":"script","id":"QO-3b1lvo","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb.subviews = function() {\n  svw.delete('combat-1')\n  svw.make('combat-1', { })\n  cb.window1 = $('#svw-combat-1')\n  cb.window1\n    .css('background','rgba(5,5,5,0.67')\n    .css('border','1px solid rgba(44,44,44,0.14)')\n    .css('left','2px')\n    .css('top', '2px')\n    .css('height','calc(50% - 15px)')\n    .css('width','214px')\n    \n  svw.delete('combat-2')\n  svw.make('combat-2', { })\n  cb.window2 = $('#svw-combat-2')\n  cb.window2\n    .css('background','rgba(5,5,5,0.67')\n    .css('border','1px solid rgba(44,44,44,0.14)')\n    .css('left','2px')\n    .css('top', 'calc(50% - 10px)')\n    .css('height','calc(50% - 15px)')\n    .css('width','214px')\n    \n  svw.delete('combat-3')\n  svw.make('combat-3', { })\n  cb.window3 = $('#svw-combat-3')\n  cb.window3\n    .css('background','rgba(5,5,5,0.67')\n    .css('border','1px solid rgba(44,44,44,0.14)')\n    .css('border-left', '1px solid rgba(5,5,5,0.67)')\n    .css('border-right', '1px solid rgba(5,5,5,0.67)')\n    .css('left','calc(2px + 213px + 1px + 3px)')\n    .css('top', 'calc(100% - 24px - 74px + 1px)')\n    .css('height','calc(74px - 31px + 2px)')\n    .css('width','calc(100% - 213px - 6px - 23% - 2px)')\n    \n  svw.delete('combat-4')\n  svw.make('combat-4', { })\n  cb.window4 = $('#svw-combat-4')\n  cb.window4\n    .css('background','rgba(1,1,1,0.65')\n    .css('background-image','url(\"./core/resources/raster.png\")')\n    .css('border','1px solid rgba(44,44,44,0.14)')\n    .css('border-top-right-radius','5px')\n    .css('border-top-left-radius','5px')\n    .css('left','calc(2px + 213px + 1px + 3px)')\n    .css('top', 'calc(100% - 22px)')\n    .css('height','24px')\n    .css('width','calc(100% - 213px - 6px - 23% - 2px)')\n    \n  // Expand Main Subwindows\n  cb._selfwindowRender()\n  cb._targetwindowRender()\n    \n  $('body').trigger('combat-mode')\n}"},{"name":"cb, unview","type":"script","id":"QO-2a0rgw","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb.unview = function() {\n  svw.delete('combat-1')\n  svw.delete('combat-2')\n  svw.delete('combat-3')\n  svw.delete('combat-4')\n  \n  $('body').trigger('combat-off')\n}\n\n"},{"name":"cb, combatMode","type":"script","id":"QO-cx8vvi","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb.combatMode = function() {\n  $('#output-container')\n    .css('left','calc(213px + 6px)')\n    .css('width','calc(100% - 213px - 6px - 23%)')\n  $('#output')\n    .css('height','calc(100% - 24px - 74px)')\n  $('#panel')\n    .css('bottom','calc(0% + 24px)')\n  var c = svw.retrieve('chat')\n  var w = c.width()\n  c.css('left','calc(219px + (100% - 213px - 6px - 23%) - ' + w + 'px - 4px)')\n  \n  setTimeout(function(){\n    fastdom.mutate(function() { Core._output_.scrollTop = Core._output_.scrollHeight })\n  }, 120)\n}\n\ncb.uncombatMode = function() {\n  $('#output-container')\n    .css('left','0%')\n    .css('width','100%')\n    \n  $('#output')\n    .css('height','calc(100% - 24px)')\n  $('#panel')\n    .css('bottom','calc(0%)')\n    \n  var c = svw.retrieve('chat')\n  c.css('left','calc(69% - 8px)')\n   .css('top', '8px')\n   .css('height','31%')\n   .css('width','31%')\n   \n  setTimeout(function(){\n    fastdom.mutate(function() { Core._output_.scrollTop = Core._output_.scrollHeight })\n  }, 120)\n}"},{"name":"event, combat-mode","type":"script","id":"QO-4bpzhm","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb.eventify = function() {\n  $('body')\n     .off('combat-mode')\n     .on('combat-mode', function(e,v){\n       cb.combatMode()\n     })\n     .off('combat-off')\n     .on('combat-off', function(e,v){\n       cb.uncombatMode()\n     })\n}\n\ncb.eventify()\n\n/*\nsetTimeout(function(){\n  cb.subviews()\n}, 1500)\n\nsetTimeout(function(){\n  cb.unview()\n}, 4000)\n*/"},{"name":"cb, self-window","type":"script","id":"QO-th0dse","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb._selfwindowRender = function() {\n  let rpad = Utilities.rpad\n  let lockAfflictions = ['impatience','paralysis','asthma','slickness','anorexia']\n  \n  var d = ''\n  d += '<div id=\"\">'\n  d += '</div>'\n  d += '<div id=\"selfwindow-nameplate\">'\n  d += player.name ? player.name : 'Player'\n  d += '</div>'\n  d += '<div id=\"selfwindow-afflictions\">'\n  for (var j = lockAfflictions.length - 1; j > -1; j--) {\n    d += '<div id=\"selfwindow-aff-' + lockAfflictions[j] + '\">'\n    d += rpad(lockAfflictions[j], 1) + ' '\n    d += '<span class=\"selfwindow-aff-bracket\">['\n    d += '<span class=\"selfwindow-aff-' + lockAfflictions[j] + '-bracket\">x</span>'\n    d += ']</span>'\n    d += '</div>'\n  }\n  d += '</div>'\n  \n  cb.window1.append(d)\n}\n\ncb._selfwindowUpdate = function() {\n  let lpad = Utilities.lpad\n  let rpad = Utilities.rpad\n  let p = player\n  \n  \n}\n"},{"name":"cb, target-window","type":"script","id":"QO-igw910","output":"cb = typeof cb != 'undefined' ? cb : {}\n\ncb._targetwindowRender = function() {\n  let rpad = Utilities.rpad\n  let lockAfflictions = ['impatience','paralysis','asthma','slickness','anorexia']\n  \n  var d = ''\n  d += '<div id=\"\">'\n  d += '</div>'\n  d += '<div id=\"targetwindow-nameplate\">'\n  d += cb.target ? cb.target : 'Target'\n  d += '</div>'\n  d += '<div id=\"targetwindow-afflictions\">'\n  for (var j = 0; j < lockAfflictions.length; j++) {\n    d += '<div id=\"targetwindow-aff-' + lockAfflictions[j] + '\">'\n    d += rpad(lockAfflictions[j], 1) + ' '\n    d += '<span class=\"targetwindow-aff-bracket\">['\n    d += '<span class=\"targetwindow-aff-' + lockAfflictions[j] + '-bracket\">x</span>'\n    d += ']</span>'\n    d += '</div>'\n  }\n  d += '</div>'\n  \n  cb.window2.append(d)\n}\n\ncb._targetwindowUpdate = function() {\n  let lpad = Utilities.lpad\n  let rpad = Utilities.rpad\n  let p = player\n  \n  \n}\n"}]},{"name":"Aliases","type":"folder","id":"QO-xkru8x","desc":"","is_open":false,"children":[{"name":"f, Follow","type":"alias","id":"QO-dsoifi","patterns":["^f[ ]+?(\\w+)$"],"output":"Core.send('follow ' + matches[1]) "},{"name":"ts, Touch shield","type":"alias","id":"QO-dvand7","patterns":["^ts$"],"output":"Core.send('touch shield')"}]},{"name":"Triggers","type":"folder","id":"QO-zzpt84","desc":"","is_open":false,"children":[{"name":"affliction+","type":"trigger","id":"QO-r48dxh","patterns":["^You have been afflicted with (.+?)\\.$"],"output":"Triggers.ignore(true)\nsub(matches[0], '<span class=\"mute\">' + matches[0] + '</span>')\nsub(matches[1], '<span class=\"darkred\">' + matches[1] + '</span>')"},{"name":"affliction-","type":"trigger","id":"QO-o7px48","patterns":["^You have cured the (.+?) affliction\\.$"],"output":"Triggers.ignore(true)\n// sub(matches[0], '<span class=\"mute\">' + matches[0] + '</span>')\n// sub(matches[1], '<span class=\"topaz\">' + matches[1] + '</span>')\nsub(matches[0], '<span class=\"mute\">Cured <span class=\"topaz\">-' + matches[1] + '</span>.</span>')"},{"name":"unlit+","type":"trigger","id":"QO-rwedpj","patterns":["^That pipe isn\\'t lit\\.$","^Your pipe, containing (.+?), has gone cold and dark\\.$"],"output":"Core.send('light pipes')"},{"name":"Balances","type":"folder","id":"QO-dl1oet","desc":"","is_open":false,"children":[{"name":"balance, plant","type":"trigger","id":"QO-8va502","patterns":["^You may eat another plant or mineral\\.$"],"output":"var str = ''\n\nstr += '<span class=\"topaz\">&laquo;</span>'\nstr += '<span class=\"darkyellow\">'\nstr += ' plant '\nstr += '</span>'\nstr += '<span class=\"topaz\">&raquo;</span>'\nstr += '<span class=\"mute\"> balance.</span>'\n\nsub(matches[0], str)"},{"name":"balance, salve","type":"trigger","id":"QO-5hhfyu","patterns":["^You may apply another salve to yourself\\.$"],"output":"var str = ''\n\nstr += '<span class=\"lightPurple\">&laquo;</span>'\nstr += '<span class=\"curePurple\">'\nstr += ' salve '\nstr += '</span>'\nstr += '<span class=\"lightPurple\">&raquo;</span>'\nstr += '<span class=\"mute\"> balance.</span>'\n\nsub(matches[0], str)"},{"name":"balance, tree","type":"trigger","id":"QO-vbq198","patterns":["^You may utilise the tree tattoo again\\.$"],"output":"var str = ''\n\nstr += '<span class=\"topaz\">&laquo;</span>'\nstr += '<span class=\"hotgreen\">'\nstr += ' tree '\nstr += '</span>'\nstr += '<span class=\"topaz\">&raquo;</span>'\nstr += '<span class=\"mute\"> balance.</span>'\n\nsub(matches[0], str)"},{"name":"balance, focus","type":"trigger","id":"QO-w7fvjh","patterns":["^Your mind is able to focus once again\\.$"],"output":"var str = ''\n\nstr += '<span class=\"topaz\">&laquo;</span>'\nstr += '<span class=\"hotred\">'\nstr += ' focus '\nstr += '</span>'\nstr += '<span class=\"topaz\">&raquo;</span>'\nstr += '<span class=\"mute\"> balance.</span>'\n\nsub(matches[0], str)"},{"name":"balance, smoke","type":"trigger","id":"QO-65e48v","patterns":["^Your lungs have recovered enough to smoke another mineral or plant\\.$"],"output":"var str = ''\n\nstr += '<span class=\"black\">&laquo;</span>'\nstr += '<span class=\"white\">'\nstr += ' smoke '\nstr += '</span>'\nstr += '<span class=\"black\">&raquo;</span>'\nstr += '<span class=\"mute\"> balance.</span>'\n\nsub(matches[0], str)"},{"name":"balance, sip","type":"trigger","id":"QO-z43a7e","patterns":["^You may drink another health or mana elixir\\.$"],"output":"var str = ''\n\nstr += '<span class=\"black\">&laquo;</span>'\nstr += '<span class=\"cureBlue\">'\nstr += ' sip '\nstr += '</span>'\nstr += '<span class=\"black\">&raquo;</span>'\nstr += '<span class=\"mute\"> balance.</span>'\n\nsub(matches[0], str)"}]},{"name":"Movement","type":"folder","id":"QO-3lnjqo","desc":"","is_open":true,"children":[{"name":"Flying+","type":"trigger","id":"QO-bzlido","patterns":["^(\\w+) is quickly carried up into the skies\\.$","^.+ flaps its wings a few times, lifting (\\w+) into the skies\\.$","^(\\w+) begins to flap \\w+ wings powerfully, and rises quickly up into the firmament\\.$","^(\\w+) drifts skyward, vanishing from sight\\.$","^(\\w+) crouches down upon \\w+ haunches, then with a powerful thrust of \\w+ legs, launches \\w+ straight up into the air\\.$","^(\\w+) sucks in \\w+ breath, and with a mighty blast of air exhales while uttering a word of magic\\.","^(\\w+) grabs hold of a nearby branch and swings up and out of sight into the treetops\\.$"],"output":""}]}]},{"name":"Transition","type":"folder","id":"QO-my05x2","desc":"","is_open":false,"children":[{"name":"df, dragonform","type":"alias","id":"QO-btcybr","patterns":["^df$"],"output":"Core.send('dragonform')"},{"name":"lf, lesserform","type":"alias","id":"QO-q48tje","patterns":["^lf$"],"output":"Core.send('lesserform')"},{"name":"da, dragonarmour","type":"alias","id":"QO-jkegyu","patterns":["^da$"],"output":"Core.send('dragonarmour on')"},{"name":"dragonform, start","type":"trigger","id":"QO-hdm2yi","patterns":["^Invoking the power that the line of Sycaerunax grants you, you will forth the Dragon within, and a (\\S+) light begins to emanate from your very soul\\.$","^As the (\\S+) light shining from you grows to an intensity that threatens to blind lesser beings, the mighty Dragon quickly subsumes your physical form, and raw power floods your mind\\.$"],"output":""},{"name":"dragonform, complete","type":"trigger","id":"QO-kho5fu","patterns":["^Reveling in your total mastery of the form, you beat your mighty wings, throw your massive head back, and roar your challenge to the world\\. You are Dragon\\!$"],"output":""},{"name":"dragonarmour+","type":"trigger","id":"QO-vqcx6x","patterns":["^With a low rumbling from deep within your belly, you beseech Ashaxei for protection\\. Your skin ripples as a web of crackling magical energy dances like fire across its surface, settling to solidify into a flexible, translucent shell\\.$"],"output":""}]},{"name":"Shaman","type":"folder","id":"QO-sd64vo","desc":"","is_open":false,"output":"/*\n  Ri'shen -> vigour\n  Maligus -> faster fashions\n  \n */","children":[{"name":"cb.shaman","type":"script","id":"QO-y65yus","output":""},{"name":"Triggers","type":"folder","id":"QO-20zb9v","desc":"","is_open":true,"children":[{"name":"curses+","type":"trigger","id":"QO-o980wm","patterns":["^You point an imperious finger at (\\w+), bringing the curse of (\\w+) down upon \\w+.$"],"output":"/* \nif matches[2] == target:title() then\n\tataxiaTemp.curse = curseConvert(matches[3])\n\t\n\tif ataxiaTemp.curse ~= \"breach\" then\n\t\ttarSingleAff(ataxiaTemp.curse)\n\telse\n\t\ttAffs.curseward = false\n\tend\n\t\n\tif haveAff(\"curseward\") then erAff(\"curseward\") end\n\tif ataxiaTemp.curse ~= \"breach\" and not ataxiaTemp.swiftcurse then\n\t\tsend(\"Discern \"..target)\n\t\tataxiaTemp.swiftcurse = false\n\tend\n\ttargetIshere = true\n\ttAffs.bleed = tAffs.bleed or 0\n\ttAffs.bleed = tAffs.bleed + 40\n\t\n\tcecho(\" <white>[<red>\"..tAffs.bleed..\"<white>]\")\nend\n */"},{"name":"jinx+","type":"trigger","id":"QO-nnl2cx","patterns":["^Summoning your malign power, you direct a twin assault of the curses (\\w+) and (\\w+) at (\\w+).$"],"output":"/*\ncan_jinx = false\nif type(target) ~= \"string\" then return end\n\nif matches[4] == target:title() then\n\tataxiaTemp.jinxone, ataxiaTemp.jinxtwo = curseConvert(matches[2]), curseConvert(matches[3])\n\ttarDoubleAff(ataxiaTemp.jinxone, ataxiaTemp.jinxtwo)\n\t\n\tif ataxiaTemp.jinxone ~= \"breach\" then\n\t\tsend(\"Discern \"..target)\n\tend\n\n\tif ataxiaTemp.jinxtwo == \"inflame\" then\n\t\ttempTimer(2, [[tAffs.inflame = false]])\n\tend\n\ttargetIshere = true\n\n\tif tAffs.bleed == nil then tAffs.bleed = 0 end\n\ttAffs.bleed = tAffs.bleed + 80\n\tcecho(\" <white>[<red>\"..tAffs.bleed..\"<white>]\")\nend\n\n */"},{"name":"jinx negated","type":"trigger","id":"QO-9e4qgx","patterns":["^(\\w+) is protected from your (\\w+) curse by a ward.$"],"output":"/*\nerAff(\"paralysis\")\nselectString(line,1)\nfg(\"tomato\")\nresetFormat()\ntAffs.curseward = true\n\nlocal prevented_aff = curseConvert(matches[2])\nerAff(prevented_aff)\n\ntAffs.bleed = tAffs.bleed - 40\nif tAffs.bleed < 0 then tAffs.bleed = nil end\n */"},{"name":"bloodlet+","type":"trigger","id":"QO-p19p5e","patterns":["^With grim resolve, you gesture sharply at (\\w+).$"],"output":"/*\nif tAffs.haemophilia then \n\ttAffs.bleed = tAffs.bleed or 0\n\ttAffs.bleed = tAffs.bleed + 250 \nend\n\nataxiaTemp.bloodlet = true\ntarSingleAff(\"haemophilia\")\n\ncecho(\" <white>[<red>\"..tAffs.bleed..\"<white>]\")\n */"},{"name":"bloodlet, balance","type":"trigger","id":"QO-sexmy4","patterns":["^You may let your victim's blood once again\\.$"],"output":"// ataxiaTemp.bloodlet = false"},{"name":"coagulate+","type":"trigger","id":"QO-fxs28b","patterns":["^With methodical ruthlessness you cast your hand at \\w+, a wash of cold causing \\w+ blood to evolve into something new.$"],"output":"/*\nataxiaTemp.coagulate = true\ntarSingleAff(ataxiaTemp.coagulateAff)\n\ntAffs.bleed = tAffs.bleed - 140\nif tAffs.bleed < 0 then tAffs.bleed = nil end\n */"},{"name":"coagulate, balance","type":"trigger","id":"QO-589wy3","patterns":["^You may channel spiritual energy to cause a coagulation once again\\.$"],"output":"// ataxiaTemp.coagulate = false"},{"name":"coagulate-","type":"trigger","id":"QO-kujith","patterns":["^(\\w+) does not yet bleed enough for you to unleash the coagulation\\.$"],"output":""},{"name":"relapse, balance","type":"trigger","id":"QO-hu7o22","patterns":["^You may utilise spiritual energy to relapse afflictions once again\\.$"],"output":"// ataxiaTemp.relapse = false"},{"name":"relapse+","type":"trigger","id":"QO-h59pw0","patterns":["^You manipulate the (\\w+) affliction affecting (\\w+), altering it to relapse at a later time.$"],"output":"/*\nataxiaTemp.relapse = true\nataxiaTemp.relapseAff = matches[2]\n\nif ataxiaTemp.relapseAff ~= \"paralysis\" then\n\tataxiaTemp.relapseWait = tempTimer(1.8, [[ataxiaTemp.relapseWait = nil]])\nend\n */"},{"name":"tzantza-","type":"trigger","id":"QO-pton8r","patterns":["^You sense that your victim is not adequately prepared to undertake the Tzantza curse\\.$","^Your trance is disrupted, and your surroundings are brought back into focus with a jolt, the curse upon your tongue left unuttered\\.$"],"output":"/*\nlocal tzAffs = {\"agoraphobia\", \"claustrophobia\", \"dementia\", \"epilepsy\", \"masochism\", \"recklessness\",\n\t\"vertigo\", \"confusion\", \"dizziness\", \"impatience\", \"paranoia\", \"stupidity\", \"addiction\"}\n\nif line:find(\"not adequately prepared\") then\n\tfor i,v in pairs(tzAffs) do\n\t\tif haveAff(v) then\n\t\t\terAff(v)\n\t\tend\n\tend\n\tselectString(line,1)\n\tfg(\"red\")\n\tresetFormat()\nend\n\nif ataxia.settings.paused then\n\tataxiaToggle(\"on\")\nend\n */\n\n\nsub(matches[0],'<span class=\"red\">' + matches[0] + '</span>')"},{"name":"swiftcurse+","type":"trigger","id":"QO-b2juu3","patterns":["^You weave your fingers together, calling upon the swiftcurse to aid you\\.$"],"output":"/*\ncurseCharge = 10\nswiftcursing = false\n */"},{"name":"swiftcurse, charges","type":"trigger","id":"QO-bv32te","patterns":["^The swiftcurse is empowered with another (\\d+) curses.$"],"output":"/*\ncurseCharge = tonumber(matches[2])\nswiftcursing = false\n */"},{"name":"syvis, relapse","type":"trigger","id":"QO-ql3m4j","patterns":["^You sense the insidious power of Syvis strike down (\\w+) with (\\w+).$"],"output":"/*\nif matches[2] == target:title() then\n\tataxiaTemp.relapseAff = curseConvert(matches[3])\n\t\n\ttarSingleAff(ataxiaTemp.relapseAff)\n\tataxiaTemp.relapseAff = nil\nend\n */"},{"name":"imbibe","type":"trigger","id":"QO-9fcbfv","patterns":["^You laugh sadistically as you jab an envenomed pin into your doll of (\\w+)\\.$"],"output":"/*\nif matches[2] == target:title() then\n\ttarSingleAff(ataxiaTemp.imbibeAff)\n\tataxiaTemp.imbibeAff = nil\nend\n */"}]},{"name":"Vodun Triggers","type":"folder","id":"QO-a1r7up","desc":"","is_open":false,"children":[{"name":"doll","type":"trigger","id":"QO-sxism1","patterns":["^A living vodun doll of"],"output":""},{"name":"doll count","type":"trigger","id":"QO-ma6koy","patterns":["^The doll looks to have been fashioned (\\d+) times.$"],"output":"/* \nataxiaTemp.dollFashions = tonumber(matches[2])\ndeleteLine()\ncecho(\"\\n<a_brown>[<purple>Doll<a_brown>]: <a_red>\"..ataxiaTemp.dollFashions..\"<DimGrey> fashions.\")\n */"},{"name":"doll, new","type":"trigger","id":"QO-otmy6f","patterns":["^With a quick prayer to the spirits, you expertly fashion the rope and cloth into the rough semblance of a humanoid\\.$"],"output":"/*\ncecho(\"<cyan>  (<DimGrey>new doll?<cyan>)\")\nataxiaTemp.dollFashions = 1\n */"},{"name":"fashion","type":"trigger","id":"QO-de29wp","patterns":["^You laugh darkly and squint at (\\w+) as you add some final touches to your doll of \\w+.$"],"output":"/*\nataxiaTemp.dollFashions = ataxiaTemp.dollFashions + 1\ndeleteLine()\ncecho(\"\\n<a_brown>[<purple>Doll<a_brown>]: <DimGrey>Fashioned doll, now at <a_red>\"..ataxiaTemp.dollFashions..\"<DimGrey> fashions.\")\n */"},{"name":"soulrend","type":"trigger","id":"QO-1gjkqo","patterns":["^Focusing upon the link between your doll and (\\w+), you find \\w+ sufficiently weakened to enhance your construct with (\\d+) more fashions\\.$"],"output":"/*\nataxiaTemp.dollFashions = ataxiaTemp.dollFashions + tonumber(matches[2])\ndeleteLine()\ncecho(\"\\n<a_brown>[<purple>Doll<a_brown>]: <DimGrey>Soulrend gained us <red>\"..matches[2]..\"<DimGrey> fashions. Total: <yellow>\"..ataxiaTemp.dollFashions..\".\")\n */"},{"name":"vodun paralysis","type":"trigger","id":"QO-l5in4i","patterns":["^You jab a finger harshly into the back of the doll\\'s neck\\.$"],"output":"/*\nataxiaTemp.dollFashions = ataxiaTemp.dollFashions - 1\ntarSingleAff(\"paralysis\")\ncecho(\" <yellow>(<a_red>\"..ataxiaTemp.dollFashions..\"<yellow>)\")\n */"},{"name":"vodun command","type":"trigger","id":"QO-o25v1z","patterns":["^You whisper, (.+) to the doll of (\\w+)\\.$"],"output":"/*\nvodunCheck = true\ntempTimer(0.5, [[ vodunCheck = nil ]])\n\nataxiaTemp.dollFashions = ataxiaTemp.dollFashions - 1\ncecho(\" <yellow>(<a_red>\"..ataxiaTemp.dollFashions..\"<yellow>)\")\n */"},{"name":"vodun cripple","type":"trigger","id":"QO-y4a173","patterns":["^With a prayer to the spirits, you break all the limbs on your doll of (\\w+)\\.$"],"output":"/*\nlocal affs = { \"brokenleftleg\", \"brokenrightleg\", \"brokenleftarm\", \"brokenrightarm\", \"prone\" }\nfor _, aff in pairs(affs) do\n  tAffs[aff] = true\nend\t\nraiseEvent(\"tar afflicted\", affs)\t\n\nataxiaTemp.dollFashions = ataxiaTemp.dollFashions - 7\ncecho(\" <yellow>(<a_red>\"..ataxiaTemp.dollFashions..\"<yellow>)\")\n */"},{"name":"vodun mangle","type":"trigger","id":"QO-hkhmia","patterns":["^You pour your wrath out onto the (.+) of the Vodun doll, mangling it quite horribly\\.$"],"output":"/*\nataxiaTemp.dollFashions = ataxiaTemp.dollFashions - 7\nlocal limb = matches[2]:gsub(\" \", \"\")\ntarSingleAff(\"damaged\"..limb)\ncecho(\" <yellow>(<a_red>\"..ataxiaTemp.dollFashions..\"<yellow>)\")\n */"},{"name":"vodun status","type":"trigger","id":"QO-vrn3rm","patterns":["^You gaze into the eyes of the doll and see that (\\w+) has a health of (\\d+)/(\\d+) and a mana of (\\d+)/(\\d+).$"],"output":"/*\nlocal mp, mmp, hp, mhp = matches[4], matches[5], matches[2], matches[3]\ndeleteLine()\ncecho(\"\\n<orange>  [<white>\"..target:title()..\"<orange>]  <red>HP: <firebrick>\"..math.floor((hp/mhp)*100)..\"%<white>  |  <blue>MP: <DodgerBlue>\"..math.floor((mp/mmp)*100)..\"%<orange>  [<white>\"..target:title()..\"<orange>]\")\n */"}]}]},{"name":"Hyperfocus","type":"folder","id":"QO-tp4con","desc":"","is_open":false,"children":[{"name":"Balance+","type":"trigger","id":"QO-0cm5qn","patterns":["^You have recovered (balance) on all limbs\\.$"],"output":"sub(matches[0], '<span class=\"orange\">' + matches[0] + '</span>')\nsub(matches[1], '<span class=\"hotred\">BALANCE</span>')"},{"name":"Equilibrium+","type":"trigger","id":"QO-lzslo1","patterns":["^You have recovered (equilibrium)\\.$"],"output":"sub(matches[0],'<span class=\"topaz\">' + matches[0] + '</span>')\nsub(matches[1],'<span class=\"darkyellow\">EQUILIBRIUM</span>')"},{"name":"Clot","type":"trigger","id":"QO-h62c55","patterns":["^You exert superior mental control and your wounds clot before your eyes\\.$"],"output":"sub(matches[0],'<span class=\"black\">Clot.</span>')"},{"name":"Paragon absorb","type":"trigger","id":"QO-am1rvo","patterns":["^Your paragon completely absorbs the damage\\.$"],"output":"sub(matches[0], '<span class=\"orange\">' + matches[0] + '</span>')"}]}]},{"name":"Bashing","type":"folder","id":"QO-48xl1h","desc":"","is_open":true,"children":[{"name":"bashing","type":"script","id":"QO-y7zsfx","output":"bash = typeof bash != 'undefined' ? bash : {}\n\nbash.print = Core.printdown\nbash.pre   = Client.prefix\nbash.state = bash.state || 0\nbash.prefix = '(<span class=\"turquoise\">bash</span>) '\n\nbash.report = function(msg) {\n  var str = '<span class=\"mute\">' + bash.prefix + msg + '</span>'\n  var pre = bash.pre()\n  bash.print(pre + str)\n}\n\nbash.target           = typeof bash.target != 'undefined' ? bash.target : 'nothing'\nbash.shielded         = false\nbash.unknownToxins    = 0\nbash.unknownThreshold = 3\n\nbash.on  = function() {\n  bash.state = 1\n  bash.report('Bashing <span class=\"green\">ON</span>.')\n  \n  if (typeof bash.aggregator != 'undefined') {\n    bash.aggregator.createSession()\n    \n    bash.subviews()\n  }\n}\nbash.off = function() {\n  bash.state = 0\n  bash.report('Bashing <span class=\"darkred\">OFF</span>.')\n  \n  if (typeof bash.aggregator != 'undefined') {\n    bash.aggregator.save()\n    \n    svw.delete('bash-summary')\n  }\n}\n\nbash.setTarget = function(tar) {\n  bash.target = tar\n  bash.report('Bashing target set to <span class=\"yellow\">' + bash.target + '</span>.')\n}\n\nbash.attack = function(tar) {\n  var target = tar || bash.target\n  if (bash.unknownToxins >= bash.unknownThreshold) {\n    var sep = '|'\n    var cmd = ''\n    cmd += 'diag'\n    cmd = 'queue addclear bal consider ' + target + sep + cmd\n    Core.send(cmd)\n    return\n  }\n  \n  if (typeof gmcp != 'undefined' &&\n      typeof gmcp.Char != 'undefined' && \n      typeof gmcp.Char.Status != 'undefined' && \n      typeof gmcp.Char.Status.class != 'undefined') {\n          \n    bash.class = gmcp.Char.Status.class\n    switch(bash.class) {\n      case('Silver Dragon'):\n        bash.dragon.attack(target)\n        break;\n      case('Shaman'):\n        bash.shaman.attack(target)\n        break;\n      default:\n        break;\n    }\n  } else {\n    bash.shaman.attack(target)\n  }\n}"},{"name":"bash.subviews","type":"script","id":"QO-utmsxp","output":"bash = typeof bash != 'undefined' ? bash : {}\n\nbash.subviews = function() {\n  svw.delete('bash-summary')\n  svw.make('bash-summary', { \n    \n  })\n  bash._windowSummary = $('#svw-bash-summary')\n  bash._windowSummary\n    .css('background','rgba(24,24,24,0.95')\n    .css('border','1px solid rgba(44,44,44,0.44)')\n    .css('left','calc(69% - 8px)')\n    .css('top','calc(8px + 31% + 8px)')\n    .css('height','31%')\n    .css('width','31%')\n    .draggable({\n    })\n\n  // post-hoc modifications\n  bash._windowSummary.append('<div id=\"bash-summary-background\"><img id=\"bash-summary-backgroundImage\"></img></div>')\n  bash._windowSummary.append('<div id=\"bash-summary-content\"></div>')\n  bash._windowContent = $('#bash-summary-content')\n}\n\n// bash.subviews()"},{"name":"bash.css","type":"script","id":"QO-6ns7wr","output":"bash = typeof bash != 'undefined' ? bash : {}\n\nbash.className = \"bash-rules\"\n\nbash.inject = function(rule) {\n  if (!rule) { return }\n  $('body').append('<div class=\"' + bash.className + '\">&shy;<style>' + rule + '</style></div>')\n}\n\nbash.css = function() {\n  $('.' + bash.className).remove()\n  bash.inject(`\n  #bash-summary-background {\n    position: absolute;\n    top: 0%;\n    left: 0%;\n    height: 100%;\n    width: 100%;\n    background-image: url(\"./core/resources/raster.png\");\n  }\n  #bash-summary-backgroundImage {\n    content: url(\"./core/resources/bash.e1.png\");\n    position: absolute;\n    top: 2%;\n    right: 0%;\n    width: calc(32%);\n    height: calc(96%);\n    filter: grayscale(0.45) sepia(0.55) brightness(0.75);\n  }\n  #bash-summary-content {\n    position: absolute;\n    top: 0%;\n    left: 0%;\n    height: calc(100% - 0.7em);\n    width: calc(100% - 0.7em);\n    background: rgba(14,14,14,0.44);\n    padding-top: 0.7em;\n    padding-left: 0.7em;\n  }\n  .bash-summary-header, .bash-summary-element {\n    font-family: Lekton;\n    font-size  : 9pt;\n    white-space: pre-wrap;\n    line-height: 14px;\n    color: rgba(144,144,144,1);\n  }\n  .bash-summary-header {\n    line-height: 19px;\n    color: rgba( 108, 108, 108, 1.00 );\n  }\n  .bash-summary-element {\n    color: rgba(144,144,144,1);\n  }\n  .bash-gold {\n    color: rgba( 125, 125,  17, 1.00 );\n  }\n  .bash-kills {\n    color: rgba( 185,  15,  45, 1.00 );\n  }\n  `)\n}\n\nbash.css()"},{"name":"bash, gmcp routing","type":"script","id":"QO-5cpznw","output":"bash = typeof bash != 'undefined' ? bash : {}\n\nbash._priorRoom = bash._priorRoom || 0\nbash._willStrike = bash._willStrike || false\nbash._strikeTimer = bash._strikeTimer || ''\n\nbash._gmcp = function(data) {\n  let datum = data.data\n  switch (data.key) {\n    case 'Room.Info':\n      bash._handleRoomChange(data.data)\n      break;\n      \n    case 'Room.Players':\n      bash._handleRoomPlayers(data.data)\n      break;\n      \n    case 'Room.AddPlayer':\n      bash._handleRoomAddPlayer(data.data)\n      break;\n    \n    case 'Room.RemovePlayer':\n      bash._handleRoomRemovePlayer(data.data)\n      break;\n      \n    default:\n      break;\n  }\n}\n\nbash._handleRoomChange = function(data) {\n  var newRoom = data.num\n  if (bash.state == 1 && bash._priorRoom != newRoom) {\n    bash._willStrike = true\n    return\n  }\n  bash._willStrike = false\n}\n\nbash._handleRoomPlayers = function(data) {\n  var me = player.name\n  var alone = true\n  for (var k = 0; k < data.length; k++) {\n    let n = data[k].name\n    if (n != me) {\n      alone = false\n      return alone\n    }\n  }\n  // Alone\n  if (bash._willStrike) {\n    clearTimeout(bash._strikeTimer)\n    bash._strikeTimer = setTimeout(function() { bash.attack() }, 120 )\n  }\n  return alone\n}\n\nbash._handleRoomAddPlayer = function(data) {\n  let n = data.name\n}\n\nbash._handleRoomRemovePlayer = function(data) {\n  let n = data \n}"},{"name":"bash (.+?)","type":"alias","id":"QO-fx3j0n","patterns":["^bash([ ]+?(.+?))*$"],"output":"var argument = matches[1]\nif (argument) {\n  argument = argument.replace(' ','')\n  switch (argument) {\n    case 'on' : bash.on();  break;\n    case 'off': bash.off(); break;\n    default:\n      if (bash.state === 0) { bash.on() }\n      bash.setTarget(argument)\n      bash.attack()\n      break;\n  }\n} else {\n  bash.state === 1 ? bash.off() : bash.on()\n}"},{"name":"balance+","type":"trigger","id":"QO-dl3b2f","patterns":["^You have recovered (balance) on all limbs\\.$"],"output":"if (bash.state === 1) {\n  bash.attack()\n}"},{"name":"equilibrium+","type":"trigger","id":"QO-wuqa7x","patterns":["^You have recovered equilibrium\\.$"],"output":"if (bash.state === 1) {\n  bash.attack()\n}"},{"name":"stun-","type":"trigger","id":"QO-aw88f9","patterns":["^You are no longer stunned\\.$"],"output":"if (bash.state === 1) {\n  bash.attack()\n}"},{"name":"slain+","type":"trigger","id":"QO-0bb2g7","patterns":["^You have slain (.+?), retrieving the corpse\\.$"],"output":"sub(matches[1], '<span class=\"darkred\">' + matches[1] + '</span>')\n\nbash.aggregator.accrete(matches[1])"},{"name":"shield+","type":"trigger","id":"QO-iyt5qq","patterns":["^A nearly invisible magical shield forms around (.+?)\\.$"],"output":"bash.shielded = true\nif (bash.state === 1) { bash.attack() } // reset the attack"},{"name":"shield rebound","type":"trigger","id":"QO-gdhoev","patterns":["^A dizzying beam of energy strikes you as your attack rebounds off of (.+?)\\'s shield\\.$"],"output":"bash.shielded = true\nif (bash.state === 1) { bash.attack() } // reset the attack"},{"name":"shielded-","type":"trigger","id":"QO-df59l3","patterns":["^You prepare yourself to flick your tail at (.+?) before realising that doing so would not actually do anything\\.$","^You flick your tail at (.+?), dismissively brushing aside the paltry shield protecting (?:him|her)\\.$"],"output":"bash.shielded = false\nif (bash.state === 1) { bash.attack() } // reset the attack"},{"name":"diagnose","type":"trigger","id":"QO-buxxtf","patterns":["^You are\\:$"],"output":"bash.unknownToxins = 0"},{"name":"toxin, unknown","type":"trigger","id":"QO-tw1s8s","patterns":["^You are confused as to the effects of the venom\\.$"],"output":"bash.unknownToxins += 1\n\nTriggers.ignore(true)\nsub(matches[0], '<span class=\"darkyellow\">' + matches[0] + '</span>')"},{"name":"Accountant","type":"folder","id":"QO-hiyonq","desc":"","is_open":false,"children":[{"name":"bash.aggregator","type":"script","id":"QO-ix096l","output":"// save intra-edit sessional data\nif (typeof bash != 'undefined' &&\n    typeof bash.aggregator != 'undefined' && \n    typeof bash.aggregator.sessional == 'function') {\n\n  var sesh = bash.aggregator.sessional()\n      sesh = JSON.stringify(sesh)\n  localStorage.setItem('bash-sessional',sesh)\n}\n\n\n//start\nbash = typeof bash != 'undefined' ? bash : {}\n\nbash.aggregator = (function(){\n  let read  = meta.local.read\n  let write = meta.local.write\n  \n  let db = {}\n  let sessionData = {}\n  let key = 'bash-data'\n  let lastMob = ''\n  let autosave = true\n  let sessional = true\n  \n  // load up sessional\n  let n = localStorage.getItem('bash-sessional')\n  if (n) {\n    sessionData = JSON.parse(n)\n  }\n  \n  let load = function() {\n    db = read(key)\n    if (!db) {\n      db = {}\n      write(key,db)\n    }\n  }\n  \n  let save = function() {\n    write(key,db)\n  }\n  \n  let accrete = function(mob) {\n    if (typeof db[mob] == 'undefined') { db[mob] = {} }\n    db[mob].kills = db[mob].kills || 0\n    db[mob].kills += 1\n    \n    lastMob = mob\n    \n    if (autosave) { save() }\n    \n    // Sessional\n    if (sessional && sessionData) {\n      let area = 'unassignedArea'\n      if (player && typeof player.area == 'string') {\n        area = player.area\n      }\n      sessionData.kills[area] = sessionData.kills[area] || {}\n      sessionData.kills[area][mob] = sessionData.kills[area][mob] || {}\n      sessionData.kills[area][mob].kills = sessionData.kills[area][mob].kills || 0\n      sessionData.kills[area][mob].kills += 1\n      \n      sessionData.tally += 1\n    }\n    _display()\n  }\n  \n  let gold = function(g) {\n    let v = parseInt(g)\n    if (lastMob !== '' && typeof db[lastMob] != 'undefined') {\n      db[lastMob].gold = db[lastMob].gold || 0\n      db[lastMob].gold += v\n    }\n    if (autosave) { save() }\n    if (sessional && sessionData) {\n      let area = 'unassignedArea'\n      if (player && typeof player.area == 'string') {\n        area = player.area\n      }\n      sessionData.kills[area] = sessionData.kills[area] || {}\n      sessionData.kills[area][lastMob] = sessionData.kills[area][lastMob] || {}\n      sessionData.kills[area][lastMob].gold = sessionData.kills[area][lastMob].gold || 0\n      sessionData.kills[area][lastMob].gold += v\n      \n      sessionData.gold = sessionData.gold || 0\n      sessionData.gold += v\n    }\n    _display()\n  }\n  \n  let createSession = function() {\n    sessionData = {}\n    \n    // Timing metrics\n    sessionData.start = new Date().getTime()\n    \n    // Kill metrics\n    sessionData.kills = {}\n    sessionData.kills.unassignedArea = {}\n    \n    sessionData.tally = 0\n    sessionData.gold  = 0\n  }\n  let sessionLength = function() {\n    let stop = sessionData.end || new Date().getTime()\n    return (stop - sessionData.start) / 1000\n  }\n  let sessionStop = function() {\n    sessionData.end = new Date().getTime()\n    return (sessionData.end - sessionData.start) / 1000\n  }\n  if (!sessionData.kills) { createSession() }\n  \n  let _metrics = function() {\n    let c = 0\n    let g = 0\n    let k = db\n    for (var mobName in k) {\n      let mob = k[mobName]\n      c += mob.kills\n      g += mob.gold || 0\n    }\n    return {gold: g, kills: c}\n  }\n  \n  var _display = function() {\n    let comma = Utilities.commaThis\n    var m = _metrics()\n    let t = new Date().getTime() - sessionData.start\n    \n    let str = ''\n    str += '<div class=\"bash-summary-header\" id=\"bash-summary-title-1\">' + 'Lifetime Data' + '</div>'\n    str += '<div class=\"bash-summary-element\" id=\"bash-summary-gold\">  <span class=\"bash-gold\">' + comma(m.gold) + '</span> gold</div>'\n    str += '<div class=\"bash-summary-element\" id=\"bash-summary-kills\">  <span class=\"bash-kills\">' + comma(m.kills) + '</span> kills</div>'\n    str += '<br/>'\n    str += '<div class=\"bash-summary-header\" id=\"bash-summary-title-2\">' + 'Sessional Data' + '</div>' \n    str += '<div class=\"bash-summary-element\" id=\"bash-summary-sessionTime\">  ' + Math.floor(Math.floor(t/1000)/60) + ' minutes</div>'\n    str += '<div class=\"bash-summary-element\" id=\"bash-summary-sessionGold\">  <span class=\"bash-gold\">' + comma(sessionData.gold) + '</span> gold this session</div>'\n    str += '<div class=\"bash-summary-element\" id=\"bash-summary-sessionKills\">  <span class=\"bash-kills\">' + comma(sessionData.tally) + '</span> kills this session</div>'\n    \n    bash._windowContent.empty().append(str)\n  }\n    \n  return {\n    load: load,\n    save: save,\n    \n    // record\n    accrete: accrete,\n    gold: gold,\n    \n    // sessions\n    createSession: createSession,\n    sessionLength: sessionLength,\n    sessionStop: sessionStop,\n    \n    // get\n    data: function() { return db },\n    sessional: function() { return sessionData },\n    _metrics: _metrics,\n    _display: _display,\n    \n    // settings\n    autosave: function(v) { if (typeof v != 'undefined') { autosave = v } return v },\n  }\n})()\n\nbash.aggregator.load()"},{"name":"bash, gold+","type":"trigger","id":"QO-dtid6j","patterns":["^You pick up (\\d+) gold sovereigns\\.$","^You scoop up (\\d+) gold sovereigns\\.$"],"output":"bash.aggregator.gold(matches[1])"}]},{"name":"Additional Triggers","type":"folder","id":"QO-slejx3","desc":"","is_open":false,"children":[{"name":"gold drop+","type":"trigger","id":"QO-ojuldj","patterns":["^A large pile of sovereigns spills from the corpse\\.$","^Numerous golden sovereigns spill from the corpse\\.$","^A small pile of sovereigns spills from the corpse\\.$"],"output":"bash.goldHere = true"},{"name":"gold drop-","type":"trigger","id":"QO-cdlq5a","patterns":["^I see no \\\"gold\\\" to take\\.$","^You pick up (\\d+) gold sovereigns\\.$","^You scoop up (\\d+) gold sovereigns\\.$"],"output":"bash.goldHere = false"},{"name":"talisman+","type":"trigger","id":"QO-leoi6f","patterns":["^You have found (.+?) talisman piece\\!$"],"output":"sub(matches[0], '<span class=\"violent\">' + matches[0] + '</span>')"}]},{"name":"Rage","type":"folder","id":"QO-iyoe80","desc":"","is_open":false,"children":[{"name":"bash.rage","type":"script","id":"QO-xgu2fa","output":"bash = typeof bash != 'undefined' ? bash : {}\n\nbash.rage = 0\nbash.rageAvailable = []\n\nbash.rageReset = function() {\n  bash.rage = 0\n  bash.rageAvailable = []\n}\n\nbash.rageParse = function(list) {\n  if (!list) { return }\n  let args = list.split(',')\n  args.forEach(function(e,v){\n    let h = e.trim()\n    if (bash.rageAvailable.indexOf(h) == -1) {\n      bash.rageAvailable.push(h)\n    }\n  })\n}"},{"name":"Rage-","type":"trigger","id":"QO-mczn5g","patterns":["^Your rage fades away\\.$"],"output":"bash.rageReset()"},{"name":"Rage Count","type":"trigger","id":"QO-v5a68b","patterns":["^\\[Rage\\]\\: \\+\\d+\\.\\d+\\. Total\\: (\\d+\\.\\d+)","^\\[Rage\\]\\: \\+\\d+\\.\\d+\\. Total\\: (\\d+\\.\\d+) Now Available\\: (.+?)$"],"output":"let A = matches[1]\nlet B = parseFloat(A)\n\nbash.rage = B\n\nbash.rageParse(matches[2])"}]},{"name":"Criticals","type":"folder","id":"QO-rfg6wg","desc":"","is_open":false,"children":[{"name":"bash.crits","type":"script","id":"QO-xc9mix","output":"bash.crits = typeof bash.crits != 'undefined' ? bash.crits : {}\nbash.crits.strikes = bash.crits.strikes || 0\n\nbash.critDisplay = function() {\n  var rpad = Utilities.rpad\n  var lpad = Utilities.lpad\n  var round = Utilities.round2\n  \n  var currentTime = new Date()\n  var tstmp = ''\n  var mins  = currentTime.getMinutes()\n  var secs  = currentTime.getSeconds()\n  var mscs  = currentTime.getMilliseconds()\n      mins  = lpad(mins,2,'0')\n      secs  = lpad(secs,2,'0')\n      mscs  = lpad(mscs,3,'0')\n  tstmp = mins + ':' + secs + ':' + mscs + ' '\n  \n  var t = Utilities.clone(bash.crits)\n  var r = [\n      'CRITICAL',\n      'CRUSHING CRITICAL',\n      'OBLITERATING CRITICAL',\n      'ANNIHILATINGLY POWERFUL CRITICAL',\n      'WORLD-SHATTERING CRITICAL',\n      ]\n  var multipliers = [2,4,8,16,32]\n  var list = []\n      \n  var totalCrits = 0\n  var totalEffective = 0\n  for (var j = 0; j < r.length; j++) {\n    var n = t[r[j]]\n    totalCrits += n\n\n    var multi = multipliers[j]\n    totalEffective += multi * n\n    \n    list.push({tier: r[j], count: n, effective: multi * n})\n  }\n  \n  var p = '<span class=\"timestamp\">' + tstmp + '</span>' + '<span class=\"mutrigger\">&compfn;</span> '\n  var d = ''\n  \n  d += p + '<span class=\"mute\">' + rpad('', 62, ' ') + '</span>\\n'\n  d += p + '<span class=\"normal\">' + rpad('Total Strikes', 34, ' ') + ' : ' + lpad(bash.crits.strikes,6,' ') + '</span>\\n'\n  d += p + '<span class=\"normal\">' + rpad('Crit Rate', 34, ' ') + ' : ' + lpad(totalCrits,6,' ')\n  d += '   ' + (totalCrits / bash.crits.strikes * 100).toFixed(1) + '%</span>\\n'\n  d += p + '<span class=\"mute\">' + rpad('', 62, '=') + '</span>\\n'\n  \n  for (var k = list.length - 1; k > -1; k--) {\n    var tier = list[k].tier\n    var count = list[k].count\n    var effective = list[k].effective\n    \n    d += p + '<span class=\"normal\">  ' + rpad(tier, 32, ' ') + ' : ' + lpad(count,6,' ')\n    d += '   ' + lpad((count / bash.crits.strikes * 100).toFixed(1), 5, ' ') + '%'\n    d += '   ' + lpad((effective / totalEffective * 100).toFixed(1), 5, ' ') + '%'\n    d += '</span>\\n'\n  }\n  \n  d += p + '<span class=\"mute\">' + rpad('', 62, '=') + '</span>\\n'\n  d += p + '<span class=\"mute\">' + rpad('', 62, ' ') + '</span>\\n'\n  \n  Core.printdown(d)\n}"},{"name":"bash.crits","type":"alias","id":"QO-fkuiyw","patterns":["^crits$"],"output":"bash.critDisplay()"},{"name":"Criticals","type":"trigger","id":"QO-n53y5h","patterns":["^You have scored a (CRITICAL) hit!$","^You have scored a (CRUSHING CRITICAL) hit!$","^You have scored an (OBLITERATING CRITICAL) hit!$","^You have scored an (ANNIHILATINGLY POWERFUL CRITICAL) hit!$","^You have scored a (WORLD-SHATTERING CRITICAL) hit!!!$"],"output":"let tier = matches[1]\n\nsub(matches[0],'<span class=\"turquoise\">' + matches[0] + '</span>')\n\nbash.crits[tier]  = bash.crits[tier] || 0\nbash.crits[tier] += 1\n\n"},{"name":"strike+, Shaman","type":"trigger","id":"QO-8gjoq0","patterns":["^You point an imperious finger at (.+?) and blood begins to flow from (?:his|her) pores\\.$","^Blood continues to spurt out of (.+?)\\'s eyes, ears, nose, and mouth\\.$","^You point an imperious finger at (.+?)\\. (?:His|Her) flesh blackens and sloughs off\\.$"],"output":"bash.crits.strikes += 1"},{"name":"strike+, Dragon","type":"trigger","id":"QO-iy2o9s","patterns":["^You rip into (.+?) with your massive, deadly claws\\.$","^You charge quickly at (.+?), throwing your mighty form into (?:him|her) and sending (?:him|her) staggering back\\.$","^You puff small bolts of lightning at (.+?), enraging (?:him|her) and causing (?:him|her) to attack recklessly\\.$","^You breathe at (.+?), small bolts of lightning crackling around (?:him|her) and sensitizing (?:his|her) skin\\.$","^You open your cavernous maw and summon a blast of lightning to pulverize (.+?)\\.$"],"output":"bash.crits.strikes += 1\n\n// STORMFLARE Missing\n// You breathe a series of lightning strikes in a lattice around a stout footsoldier, but he is able to quickly dart through the lattice and avoid the bulk of the lightning strikes."}]},{"name":"Shaman","type":"folder","id":"QO-14g3qn","desc":"","is_open":false,"children":[{"name":"bash.shaman","type":"script","id":"QO-sooq8m","output":"bash.shaman = {}\n\nbash.shaman.malign = false\n\nbash.shaman.ragePreference = [\"Haemorrhage\",\"Corruption\"]\n\nbash.shaman.rage = {\n  Corruption: {\n    cost  : 14,\n    syntax: 'curse $target corruption',\n  },\n  Korkma: {\n    cost  : 29,\n    syntax: 'invoke korkma $target',\n  },\n  Vulnerability: {\n    cost  : 17,\n    syntax: 'curse $target vulnerability',\n  },\n  Haemorrhage: {\n    cost  : 36,\n    syntax: 'curse $target haemorrhage',\n  },\n  Vurus: {\n    cost  : 25,\n    syntax: 'invoke vurus $target',\n  },\n  Cesaret: {\n    cost  : 18,\n    syntax: 'invoke cesaret $target',\n  },\n}\n\nbash.shaman.attack = function(t) {\n  var sep    = '|'\n  var target = t\n  var cmd  = ''\n\n  if (bash.goldHere) {\n    cmd += 'g gold' + sep\n  }\n\n  if (bash.shaman.malign) {\n    cmd += 'jinx bleed bleed ' + target + sep\n  } else {\n    cmd += 'curse ' + target + ' bleed' + sep\n  }\n\n  if (typeof bash != 'undefined' && bash.rage > 0) {\n    var g;\n    for (var n = 0; n < bash.shaman.ragePreference.length; n++) {\n      var skill = bash.shaman.ragePreference[n]\n      if (bash.rageAvailable.indexOf(skill) != -1) {\n        bash.rageAvailable.splice(bash.rageAvailable.indexOf(skill), 1)\n        g = bash.shaman.rage[skill]\n        cmd = g.syntax.replace('$target',target) + sep + cmd\n        break\n      }\n    }\n  }\n\n  cmd = 'queue addclear bal consider ' + target + sep + cmd\n  Core.send(cmd)\n}"},{"name":"malign+","type":"trigger","id":"QO-71swdg","patterns":["^Your malign power may be unleashed in the form of a jinx against your victim\\.$"],"output":"bash.shaman.malign = true"},{"name":"jinx+","type":"trigger","id":"QO-oy4oi1","patterns":["^Summoning your malign power, you direct a twin assault of the curses (.+?) and (.+?) at (.+?)\\.$","^You have not built up enough malign power to unleash a jinx\\.$","^Your malign power dissipates back to normal levels\\.$"],"output":"bash.shaman.malign = false"},{"name":"cb, Curse Bleed","type":"alias","id":"QO-lrwesw","patterns":["^cb[ ]+?(.+)$"],"output":"bash.shaman.attack(matches[1])"}]},{"name":"Dragon","type":"folder","id":"QO-6ool2m","desc":"","is_open":false,"children":[{"name":"bash.dragon","type":"script","id":"QO-yqmjet","output":"bash.dragon = {}\n\nbash.dragon.ragePreference = [\"Overwhelm\",\"Dragonspark\",\"Sizzle\"]\n// Stormflare miss rate is high\n\nbash.dragon.rage = {\n  Overwhelm: {\n    cost  : 14,\n    syntax: 'overwhelm $target',\n  },\n  Sizzle: {\n    cost  : 25,\n    syntax: 'sizzle $target',\n  },\n  Dragonspark: {\n    cost  : 36,\n    syntax: 'dragonspark $target',\n  },\n  Stormflare: {\n    cost  : 25,\n    syntax: 'stormflare $target',\n  },\n  Galvanize: {\n    cost  : 18,\n    syntax: 'galvanize $target',\n  },\n}\n\nbash.dragon.attack = function(t) {\n  var sep    = '|'\n  var target = t\n  var cmd  = ''\n\n  if (bash.goldHere) {\n    cmd += 'g gold' + sep\n  }\n  \n  if (bash.shielded) {\n    cmd += 'tailsmash ' + target + sep\n  } else {\n    cmd += 'gut ' + target + sep\n  }\n\n  if (typeof bash != 'undefined' && bash.rage > 0) {\n    var g;\n    for (var n = 0; n < bash.dragon.ragePreference.length; n++) {\n      var skill = bash.dragon.ragePreference[n]\n      if (bash.rageAvailable.indexOf(skill) != -1) {\n        bash.rageAvailable.splice(bash.rageAvailable.indexOf(skill), 1)\n        g = bash.dragon.rage[skill]\n        cmd = g.syntax.replace('$target',target) + sep + cmd\n        break\n      }\n    }\n  }\n\n  cmd = 'queue addclear bal consider ' + target + sep + cmd\n  Core.send(cmd)\n}"},{"name":"bb, bash.attack","type":"alias","id":"QO-2ioi1u","patterns":["^bb[ ]+?(.+)$"],"output":"bash.attack(matches[1])"}]}]},{"name":"Miscellaneous","type":"folder","id":"QO-dpp42p","desc":"","is_open":false,"children":[{"name":"Chat Window","type":"folder","id":"QO-mrm5yv","desc":"","is_open":true,"children":[{"name":"chat, initial","type":"script","id":"QO-0u00iv","output":"chat = typeof chat != 'undefined' ? chat : {}\n\nchat.channelManager = {}\nchat.channels = ['All','Tells','Clans','Orgs','Public','Says','Market']\n\nchat.subview = function() {\n  svw.delete('chat')\n  svw.make('chat', { \n    \n  })\n  chat.window = $('#svw-chat')\n  chat.window\n    .css('background','rgba(24,24,24,0.95')\n    .css('background-image','url(\"./core/resources/raster.png\")')\n    .css('border','1px solid rgba(44,44,44,0.44)')\n    .css('left','calc(69% - 8px)')\n    //.css('top','calc(100% - 35% - 31px)')\n    .css('top', '8px')\n    .css('height','31%')\n    .css('width','31%')\n    /*\n    .draggable({\n      containment: '#container',\n      handle     : '#chat-header',\n      cancel     : '.chat-subtab',\n    })\n    .resizable({\n      ghost: true,\n    }) */\n  \n  chat.window.append('<div id=\"chat-header\"></div>')\n  chat.header = $('#chat-header')\n  chat.header\n    .css('position','absolute')\n    .css('left', '0px')\n    .css('top', '0px')\n    .css('height', '23px')\n    .css('width', '100%')\n    .css('cursor', 'pointer')\n\n  chat.window.append('<div id=\"chat-content\"></div>')\n  chat.content = $('#chat-content')\n  chat.content\n    .css('border-top','1px solid rgba(14,14,14,0.44)')\n    .css('background-image','url(\"./core/resources/retro-filter.png\")')\n    .css('background-size','cover')\n    .css('background-image','url(\"./core/resources/dragon.png\")')\n    .css('background-size','cover')\n    // .css('background-repeat','no-repeat')\n    .css('font-family','Lekton')\n    .css('font-size','9pt')\n    .css('line-height','13px')\n    .css('position','absolute')\n    .css('left','0px')\n    .css('top','23px')\n    .css('height','calc(100% - 23px)')\n    .css('width','100%')\n    .css('overflow-y','hidden')\n    .css('white-space','pre-wrap')\n    \n  let str = ''\n  let uve = ''\n  for (var j = 0; j < chat.channels.length; j++) {\n    let channel = chat.channels[j]\n    str += '<div id=\"chat-content-' + channel + '\" class=\"chat-subcontent '\n    if (channel != 'All') { str += 'invisible' }\n    str += '\"></div>'\n    \n    uve += '<div id=\"chat-tab-' + channel + '\" class=\"chat-subtab '\n    if (channel != 'All') { uve += 'inactive' }\n    uve += '\" onclick=\"chat.setChannel(\\'' + channel + '\\')\">' + channel + '</div>'\n  }\n  chat.content.append(str)\n  chat.header.append(uve)\n  for (var k = 0; k < chat.channels.length; k++) {\n    chat.channelManager[chat.channels[k]] = $('#chat-content-' + chat.channels[k])\n    // position tabs\n    $('#chat-tab-' + chat.channels[k])\n      .css('left', 'calc(8px + ' + ((55 + 2)* k) + 'px)')\n  }\n}\n\nchat.setChannel = function(channel) {\n  $('.chat-subtab').removeClass('inactive')\n  $('.chat-subcontent').removeClass('invisible')\n  for (var k = 0; k < chat.channels.length; k++) {\n    if (chat.channels[k] !== channel) {\n      $('#chat-tab-' + chat.channels[k]).addClass('inactive')\n      $('#chat-content-' + chat.channels[k]).addClass('invisible')\n    }\n  }\n}\n\nchat.subview()\n"},{"name":"chat, css + colors","type":"script","id":"QO-71nvfs","output":"chat = typeof chat != 'undefined' ? chat : {}\n\nchat.className = 'chat-rules'\n\nchat.colors = {\n  ['Ashtan']: {pre: 'rgba(214, 0, 43, 1)', color: 'rgba(217, 61, 92, 1)'},\n  ['Bellatores Societas']: {pre: 'rgba(7, 133, 118, 1)', color: 'rgba(43, 173, 158, 1)'},\n  ['Market']: {pre: 'rgba(150, 189, 117, 1)', color: 'rgba(86, 166, 18, 1)'},\n  ['Voidborn Insanity']: {pre: 'rgba(169, 29, 207, 1)', color: 'rgba(165, 86, 186, 1)'},\n  \n  // gmcp\n  ['ct']: {pre: 'rgba(214, 0, 43, 1)', color: 'rgba(217, 61, 92, 1)'},\n  ['clt1']: {pre: 'rgba(7, 133, 118, 1)', color: 'rgba(43, 173, 158, 1)'},\n  ['clt4']: {pre: 'rgba(169, 29, 207, 1)', color: 'rgba(165, 86, 186, 1)'},\n  ['clt5']: {pre: 'rgba(169, 29, 207, 1)', color: 'rgba(165, 86, 186, 1)'},\n  ['market']: {pre: 'rgba(150, 189, 117, 1)', color: 'rgba(86, 166, 18, 1)'},\n  ['armytell']: {pre: 'rgba(214, 45, 73, 1)', color: 'rgba(227, 91, 122, 1)'},\n}\n\nchat.inject = function(rule) {\n  if (!rule) { return }\n  $('body').append('<div class=\"' + chat.className + '\">&shy;<style>' + rule + '</style></div>')\n}\n\nchat.css = function() {\n  $('.' + chat.className).remove()\n  let rules = ''\n  for (var k in chat.colors) {\n    let key = k.replace(/\\s/g,'-') // just be aware that spaces are not tolerated by class names\n    let className = 'chat-' + key\n    rules += '.' + className + '-pre {color: ' + chat.colors[k].pre + '}\\n'\n    rules += '.' + className + '-color {color: ' + chat.colors[k].color + '}\\n'\n  }\n  \n  // additional css rules\n  rules += '.chat-subcontent {position: absolute; left: 0%; top: 0%; height: 100%; width: calc(100% - 0.2em - 34px);}\\n'\n  rules += '.chat-subcontent.invisible {display: none;}\\n'\n  \n  rules += `\n   .chat-subcontent {\n     background: rgba(14,14,14,0.44);\n     padding-top: 0.2em;\n     padding-right: 0.2em;\n     padding-left : 34px;\n     text-indent  : -34px;\n     overflow-y   : scroll;\n   }\n   .chat-subtab {\n     display: inline-block; \n     position: absolute;\n     top    : 12%;\n     height : 88%;\n     width  : 55px;\n     background  : rgba(14,14,14,0.44);\n     border-right: 1px solid rgba(34,34,34,1);\n     font-family: Lekton; \n     font-size: 8pt; \n     color: rgba(144,144,144,1);\n     text-align: center;\n     line-height: 23px;\n     border-top-left-radius: 5px;\n     border-top-right-radius: 5px;\n     user-select: none;\n    }\n   .chat-subtab.inactive {\n     color: rgba(88,88,88,1); \n     background  : rgba(14,14,14,1);\n    }\n  `\n  chat.inject(rules)\n}\n\nchat.css()"},{"name":"chat, parse","type":"script","id":"QO-wxsgmi","output":"chat = typeof chat != 'undefined' ? chat : {}\n\nchat.channelMap = {\n  ['Ashtan']: {short: 'A',  channels: ['Orgs'], pre: '', color: ''},\n  ['Bellatores Societas']: {short: 'Bella', channels: ['Clans'], pre: '', color: ''},\n  ['Market']: {short: 'M', channels: ['Market'], pre:'', color: ''},\n  ['Voidborn Insanity']: {short: 'vi', channels: ['Clans'], pre: '', color: ''},\n  ['Says']: {short: 's', channels: ['Says'], pre: 'topaz', color: 'darkyellow'},\n  ['Tells']: {short: 's', channels: ['Tells'], pre: 'orange', color: 'darkyellow'},\n  \n  // gmcp channels\n  ['armytell']: {short: 'r', channels: ['Orgs'], pre: '', color: ''},\n  ['clt1']: {short: 'Bella', channels: ['Clans'], pre: '', color: ''},\n  ['clt2']: {short: 'Azn', channels: ['Clans'], pre: '', color: ''},\n  ['clt3']: {short: 'Au', channels: ['Clans'], pre: '', color: ''},\n  ['clt4']: {short: 'vi', channels: ['Clans'], pre: '', color: ''},\n  ['clt5']: {short: 'IoE', channels: ['Clans'], pre: '', color: ''},\n  ['ct']: {short: 'A',  channels: ['Orgs'], pre: '', color: ''},\n  ['ht']: {short: 'ht', channels: ['Orgs'], pre: 'balBracket', color: 'bal'},\n  ['hnt']: {short: 'hnt', channels: ['Orgs'], pre: 'balBracket', color: 'bal'},\n  ['market']: {short: 'M', channels: ['Market'], pre: '', color: ''},\n  ['party']: {short: 'p', channels: ['Orgs'], pre: 'hotred', color: 'orange'},\n  ['says']: {short: 's', channels: ['Says'], pre: 'blue', color: 'bold cyan'},\n  ['shout']: {short: 'Shout', channels: ['Says','Public'], pre: 'hotred', color: 'violent'},\n  ['yell']: {short: 'y', channels: ['Says','Public'], pre: 'topaz', color: 'darkyellow'},\n}\n\nchat.parse = function(data) {\n  let channel = data[1]\n  let speaker = data[2]\n  let speech  = data[3]\n  \n  let pre = ''\n  let color = ''\n  \n  let M = chat.channelMap[channel]\n  if (M) {\n    pre     = M.pre\n    color   = M.color\n    \n    // seek a defined color if desired\n    if (pre === '') { pre = 'chat-' + channel.replace(/\\s/g,'-') + '-pre' }\n    if (color === '') { color = 'chat-' + channel.replace(/\\s/g,'-') + '-color' }\n    \n    channel = M.short\n  } else { console.log(channel) } // remove this when we are done\n  \n  let str = ''\n  str += '<div id=\"chat-line\">'\n  str += ' <span class=\"black\">[<span class=\"' + pre + '\">' + channel  + '</span>]</span>'\n  str += ' <span class=\"' + color + '\">' + speaker + '</span>'\n  str += '<span class=\"mute\"> &raquo; </span>'\n  str += '<span class=\"' + color + '\">' + speech + '</span>'\n  str += '</div>'\n  \n  fastdom.mutate(function(){\n    chat.channelManager.All.append(str)\n    var cm = document.getElementById('chat-content-All')\n    cm.scrollTop = cm.scrollHeight\n  })\n  if (M && M.channels) {\n    M.channels.forEach(function(chan) {\n      if (chat.channelManager[chan].length) {\n        fastdom.mutate(function() {\n          chat.channelManager[chan].append(str)\n          var f = document.getElementById('chat-content-' + chan)\n          f.scrollTop = f.scrollHeight\n        })\n      }\n    })\n  }\n}"},{"name":"chat._gmcp","type":"script","id":"QO-uhu0g2","output":"chat = typeof chat != 'undefined' ? chat : {}\n\nchat._regexAnsi = /.\\[(?:\\d+\\;)*\\d+\\;\\d+m/g\nchat._regexContent = /\".+?\"$/g\n\nchat._gmcp = function(data) {\n  let datum = data.data\n  \n  let channel = datum.channel\n  let speaker = datum.talker.toProperCase()\n  let text    = datum.text\n  \n  try {\n   text = text.replaceAll(chat._regexAnsi, '')\n   text = text.match(chat._regexContent)[0]\n   text = text.substring(0, text.length - 1).substring(1)\n  } catch(err) { console.log(err) }\n  chat.parse([datum.text,channel,speaker,text])\n}"}]},{"name":"Movement","type":"folder","id":"QO-vlm8cl","desc":"","is_open":false,"children":[{"name":"ew, enter wilderness","type":"alias","id":"QO-y1n345","patterns":["^ew$"],"output":"Core.send('enter wilderness')"},{"name":"lw, leave wilderness","type":"alias","id":"QO-gsdm3g","patterns":["^lw$"],"output":"Core.send('leave wilderness')"}]},{"name":"Ambience","type":"folder","id":"QO-hgto0p","desc":"","is_open":false,"children":[{"name":"ambient, gold+","type":"trigger","id":"QO-g2gfu9","patterns":["^You pick up (\\d+) gold sovereigns\\.$","^You scoop up (\\d+) gold sovereigns\\.$"],"output":"sub(matches[1], '<span class=\"yellow\">' + matches[1] + '</span>')\n$('body').trigger('ambient','gold')"},{"name":"ambient, paragon+","type":"trigger","id":"QO-ovxko2","patterns":["^Your paragon completely absorbs the damage\\.$"],"output":"$('body').trigger('ambient','paragon')"},{"name":"ambient, rain","type":"trigger","id":"QO-htglgc","patterns":["^It is raining heavily, pregnant drops of water pouring down onto you\\.$","^Rain cascades down from the skies, drenching you and your environment\\.$","^Like a waterfall, rain pours down around you, soaking you thoroughly\\.$","^Occasional drops of rain fall to the ground from a sky grey with pregnant clouds\\.$","^Occasional raindrops fall on your head as the drizzle continues\\.$","^A light rain wets your surroundings, falling pleasantly around you\\.$","^A wall of sound, tangible in its fury, slams into you as lightning falls like rain on a distant location\\.$"],"output":"$('body').trigger('ambient','rain')"},{"name":"ambient, talisman+","type":"trigger","id":"QO-5x827w","patterns":["^You have found (.+?) talisman piece\\!$"],"output":"$('body').trigger('ambient','drop')"},{"name":"ambient, tells","type":"trigger","id":"QO-15yjdr","patterns":["^(\\w+) tells you, \"(.+?)\"$"],"output":"$('body').trigger('ambient','message')"},{"name":"ambient, sanction","type":"trigger","id":"QO-nmquf4","patterns":["^\\(Army\\)\\: A call to arms goes out as sanctioned raid is delcared against your city\\.$"],"output":"$('body').trigger('ambient','sanction')"}]},{"name":"Samples","type":"folder","desc":"Feel free to also delete this with impunity.","id":"QO-m8lvcw","is_open":false,"output":"","children":[{"name":"shop.summative","type":"trigger","patterns":["^[ ]+?(.+?) (.+?)[ ]+?(\\d+)[ ]+?(\\d+)gp$"],"output":"\nvar comma  = Utilities.commaThis\nvar lpad   = Utilities.lpad\n\nvar count = matches[3]\nvar price = matches[4]\n\nappend('<span class=\"topaz\">' + lpad(comma(count * price), 11) + '</span> <span class=\"mute\">gold</span>')\n","id":"QO-m9kp5n"},{"name":"credit","type":"script","output":"\ncredit = typeof credit != 'undefined' ? credit : {}\n\ncredit.reset = function() {\n  credit.collation = []\n  $('.credit-anchor')\n     .removeClass('credit-replaceable')\n     .removeAttr('onmouseover').removeAttr('onmouseout');\n}\ncredit.reset()\n\ncredit.summation = function(m) {\n  var comma  = Utilities.commaThis\n  var lpad   = Utilities.lpad\n  var rpad   = Utilities.rpad\n  \n  var number = parseInt(m[2].replace(/[^0-9]/g,''))\n  var cost   = parseInt(m[3].replace(/[^0-9]/g,''))\n\n  sub(m[3],'<span class=\"yellow\">' + lpad(comma(cost), 8) + '</span> gold')\n  /*\n  sub(m[1],'')\n  sub(m[2],'<span class=\"darkyellow\">' + lpad(comma(number), 9) + '</span> credit')\n  sub({\n    method: 'inline-substitution',\n    target: m[1],\n    output: '',\n  })\n  sub({\n    method: 'inline-substitution',\n    target: m[2],\n    output: '<span class=\"darkyellow\">' + lpad(comma(number), 9) + '</span> credit',\n  })\n  sub({\n    method: 'inline-substitution',\n    target: m[3],\n    output: '<span class=\"yellow\">' + lpad(comma(cost), 8) + '</span> gold',\n  })\n  */\n  \n  var cum = 0\n  var last = credit.collation[(credit.collation.length - 1)]\n  if (last) {\n    cum = number * cost + last.cum\n  } else { cum = number * cost }\n  credit.collation.push({number: number, cost: cost, sum: number * cost, cum: cum})\n  \n  var mode = 'hover'\n  var output  = '.'\n      output += '<span class=\"credit-anchor credit-replaceable\" '\n      if (mode == 'hover') {\n       output += 'onmouseover=\"credit.display(this, \\'' + (credit.collation.length - 1) + '\\')\" '\n       output += 'onmouseleave=\"credit.disguise()\">'\n      } else {\n       output += 'onmouseover=\"credit.show(this, \\'' + cum + '\\')\" '\n       output += 'onmouseleave=\"credit.hide()\">'\n      }\n      output += ' <span class=\"darkyellow\">'\n      output += lpad(comma(number * cost), 12)\n      output += '</span> gold</span>'\n  \n  /*\n  sub({\n    method: 'inline-substitution',\n    target: '.',\n    output: output,\n  })\n  */\n  sub('.', output)\n}\n\ncredit.display = function(e, index) {\n  var comma  = Utilities.commaThis\n  var lpad   = Utilities.lpad\n  var len    = $('.credit-replaceable').length\n  for (var k = 0; k < (len-1); k++) {\n    var v  = credit.collation[k].sum\n    var el = $('.credit-replaceable')[k]\n        el.children[0].classList.remove('topaz', 'credit-cumulative')\n        el.children[0].classList.add('darkyellow')\n        el.children[0].innerHTML = lpad(comma(v), 12)\n  }\n  \n  for (var k = 0; k < (parseInt(index) + 1); k++) {\n    var v  = credit.collation[k].cum\n    var el = $('.credit-replaceable')[k]\n        el.children[0].classList.remove('darkyellow')\n        el.children[0].classList.add('topaz', 'credit-cumulative')\n        el.children[0].innerHTML = lpad(comma(v), 12)\n  }\n}\n\ncredit.disguise = function() {\n  var comma  = Utilities.commaThis\n  var lpad   = Utilities.lpad\n  \n  $('.credit-replaceable').each(function(index, el){\n    var v = credit.collation[index].sum\n    el.children[0].classList.remove('topaz', 'credit-cumulative')\n    el.children[0].classList.add('darkyellow')\n    el.children[0].innerHTML = lpad(comma(v), 12)\n  })\n}\n\ncredit.show = function(e, v) {\n  var comma   = Utilities.commaThis\n  var r       = e.getBoundingClientRect()\n  var offsetX = r.right + 13\n  var offsetY = r.top\n\n  var d  = ''\n      d += '<div class=\"credit-display\" style=\"font-family:\\'Lekton\\'; font-size:9pt;'\n      d += ' position: absolute; z-index: 44; left: ' + offsetX + 'px; top: ' + offsetY + 'px;'\n      d += ' height: 16px; width: auto; padding-left: 2px; '\n      d += ' background-color: rgba( 1, 1, 1, 0.88 ); border-radius: 3px;\"'\n      d += '><span class=\"darkyellow\">' + comma(v) + '</span><span class=\"mute\"> cum.</span>'\n      d += '</div>'\n  $('#container').append(d)\n}\n\ncredit.hide = function() {\n  $('.credit-display').remove()\n}\n","id":"QO-ksg2yu"},{"name":"credit.reset","type":"trigger","patterns":["^Credits currently available for purchase:$"],"output":" credit.reset()","id":"QO-afrmtr"},{"name":"credit.summation","type":"trigger","patterns":["^([ ]+?)(\\d+ credit)s* at (\\d+ gold) per credit\\.$"],"output":" credit.summation(matches)","id":"QO-208yfb"},{"name":"tutelage","type":"trigger","id":"QO-6t102n","patterns":["^(\\w+) has requested that you share"],"output":"var whitelist = ['Urzael','Swikaan']\n\nif (whitelist.indexOf(matches[1]) != -1) {\n  Core.send('ok')\n}"}]},{"name":"Gags","type":"folder","id":"QO-0tygfd","desc":"","is_open":false,"children":[{"name":"System","type":"folder","id":"QO-ki8ksw","desc":"","is_open":true,"children":[{"name":"queue-","type":"trigger","id":"QO-g8t4mq","patterns":["^\\[System\\]\\: Queued balance commands cleared\\.$"],"output":"sub(matches[0],'')"}]}]},{"name":"Forays","type":"folder","id":"QO-ux8f1z","desc":"","is_open":false,"children":[{"name":"Forays","type":"script","id":"QO-160us0","output":"forays = typeof forays != 'undefined' ? forays : {}\n\nforays.triggered = forays.triggered || 0\nforays.available = forays.available || []\n\nforays.parse = function() {\n  console.log(forays.available)\n  \n  forays.available = []\n}"},{"name":"Forays triggered","type":"trigger","id":"QO-jyjebd","patterns":["^Running an eye over a foray board, you study the forays available\\:$"],"output":"forays.triggered = 1"},{"name":"Foray count+","type":"trigger","id":"QO-vibg4r","patterns":["^(\\d+)\\:\\s+?([a-z]+)$"],"output":"if (forays.triggered > 0) {\n  var c = matches[1]\n  var f = matches[2]\n  forays.available.push({key: c, foray: f})\n}"},{"name":"Forays border","type":"trigger","id":"QO-b3yx6l","patterns":["^--------------------------------------------------------------------------------$"],"output":"if (forays.triggered > 0) {\n  forays.triggered += 1\n  \n  if (forays.triggered > 2) {\n    forays.triggered = 0\n    forays.parse()\n  }\n}"}]},{"name":"Talismans","type":"folder","id":"QO-ehr987","desc":"","is_open":false,"children":[{"name":"talismans","type":"script","id":"QO-tyhspf","output":"talismans = (function(){\n  // Replace these 4 functions with your own as they are not included.\n  var print     = Core.printdown\n  var send      = Core.send\n  var lpad      = Utilities.lpad\n  var rpad      = Utilities.rpad\n  \n  var active    = false\n  var cmd_list  = 'talisman pieces'\n\n  var dragons   = ['Black','Blue','Gold','Green','Red','Silver']\n  var pieces    = ['bone','claw','eye','heart','leather','tooth','scale','special']\n  var specials  = {Black: 'acid sac', Blue: 'lung', Gold: 'brain stem', Green: 'poison sac', Red: 'belly', Silver: 'larynx'}\n  var inventory = {}\n  \n  var setup = function() {\n    dataset()\n    active = false\n  \n    var inject = function(rule) { $('body').append('<div class=\"tls-rules\">&shy;<style>' + rule + '</style></div>') }\n    if ( $('.tls-rules').length ) { $('.tls-rules').remove() }\n    var rules = `\n    .BlackDragon   { color: rgba(165,175,185,1); }\n    .BlueDragon    { color: rgba(135,165,210,1); }\n    .GoldDragon    { color: rgba(180,165, 85,1); }\n    .GreenDragon   { color: rgba(155,185, 85,1); }\n    .RedDragon     { color: rgba(200, 25, 25,1); }\n    .SilverDragon  { color: rgba(140,140,140,1); }`\n    inject(rules)\n  }\n  \n  var dataset = function() {\n    for (var type in specials) {\n      inventory[type] = {}\n      for (var i = 0; i < pieces.length; i++) {\n        var piece = pieces[i]\n        var special = false\n        if (piece == 'special') { piece = specials[type]; special = true; }\n        inventory[type][piece] = {}\n        if (special) {\n          for (var j = 1; j < 4; j++) { inventory[type][piece]['L'+j] = 0 }\n        } else {\n          for (var j = 1; j < 8; j++) { inventory[type][piece]['L'+j] = 0 }\n        }\n      }\n    }\n  }\n  \n  var parse = function(m) {\n    var t = {}\n    t.count = m[1]\n    t.type  = m[2]\n    t.piece = m[3]\n    t.level = m[4]\n    inventory[t.type] = inventory[t.type] || {}\n    inventory[t.type][t.piece] = inventory[t.type][t.piece] || {}\n    inventory[t.type][t.piece]['L'+t.level] = parseInt(t.count)\n  }\n  \n  var write = function() {\n    var str = '<span class=\"QO-line mute\">'\n        str += rpad('', 30) + ' '\n        str += 'L1    '\n        str += 'L2    '\n        str += 'L3    '\n        str += 'L4    '\n        str += 'L5    '\n        str += 'L6    '\n        str += 'L7    '\n        str += '</span>\\n<span class=\"QO-line mute\">' + rpad('+',83,'-') + '+</span>'\n    for (var k in inventory) {\n      for (var n in inventory[k]) {\n        str += '\\n'\n        str += '<span class=\"QO-line mute\">|<span class=\"' + k + 'Dragon\"> ' + rpad(lpad(k, 7) + ' Dragon ' + n, 28) + '</span>'\n        var sum = 0\n        var special = false\n        for (var v in specials) { var e = specials[v]; if (e == n) { special = true } }\n        for (var o in inventory[k][n]) {\n          var count = inventory[k][n][o]\n          var rank  = parseInt(o.replace('L',''))\n          sum += count * Math.pow(2, rank - 1)\n          if (count !== 0) { str += '<span class=\"' + k + 'Dragon\">' }\n          str += rpad('  ' + count, 6)\n          if (count !== 0) { str += '</span>' }\n        }\n        if (special) {\n          str += rpad('', 25) + '  <span class=\"' + k + 'Dragon\">' + lpad(sum, 2, ' ') + '</span> / 4 '\n        } else {\n          str += '  <span class=\"' + k + 'Dragon\">' + lpad(sum, 3, ' ') + '</span> / 64'\n        }\n        str += ' |</span></span>'\n      }\n    }\n    str += '\\n<span class=\"QO-line mute\">' + rpad('+',83,'-') + '+</span>'\n    // console.log(str)\n    print(str)\n  }\n  \n  var activate = function(v) { if (typeof v == 'boolean') { active = v }; return active }\n\n  return {\n    active: activate,\n    parse : parse,\n    setup : setup,\n    write : write,\n    border: 0,\n    data  : function() { return inventory },\n    reset : function() { inventory = {}; dataset() },\n  }\n})()\n\ntalismans.setup()"},{"name":"talisman.pieces","type":"alias","id":"QO-tj9rfg","patterns":["^tp$"],"output":"talismans.active(true)\ntalismans.reset()\ntalismans.border = 0\nCore.send('talisman pieces')"},{"name":"talismans.more","type":"trigger","id":"QO-0vwcbu","patterns":["^\\[Type MORE if you wish to continue reading\\. \\(\\d+\\% shown\\)\\]$"],"output":"if (talismans.active()) {\n  Core.send(\"more\")\n}"},{"name":"talismans.line","type":"trigger","id":"QO-2ekr1q","patterns":["^(?:B|P)[ ]+(\\d+)[ ]+a (\\w+) Dragon's (\\w+)[ ]+(\\d+)[ ]+Dragon[ ]+(\\w+)$","^(?:B|P)[ ]+(\\d+)[ ]+a (\\w+) Dragon (\\w+)[ ]+(\\d+)[ ]+Dragon[ ]+(\\w+)$","^(?:B|P)[ ]+(\\d+)[ ]+(\\w+) Dragon (leather)[ ]+(\\d+)[ ]+Dragon[ ]+(\\w+)$","^(?:B|P)[ ]+(\\d+)[ ]+a (Black|Gold|Green) Dragon's (acid sac|brain stem|poison sac)[ ]+(\\d+)[ ]+Dragon[ ]+(\\w+)$"],"output":"talismans.parse(matches)"},{"name":"talismans.off","type":"trigger","id":"QO-zikjn1","patterns":["^----------------------------------------------------------------------------------$"],"output":"if (talismans.active()) {\n  if (talismans.border === 0) {\n    talismans.border = 1\n  } else  if (talismans.border >= 1) {\n    talismans.active(false)\n    setTimeout(function() { talismans.write() }, 600)\n  }\n}"},{"name":"talismans.header","type":"trigger","id":"QO-sk1vqd","patterns":["^[ ]+(\\\\w+)dragonpieces"],"output":""}]},{"name":"Prospecting","type":"folder","id":"QO-qwdjas","desc":"","is_open":false,"children":[{"name":"prospecting","type":"script","id":"QO-2xirvr","output":"prospecting = (function() {\n  var clone = Utilities.clone\n  var print = function(msg) {\n    var str = '<span class=\"topaz\">(<span class=\"yellow\">digger</span>)</span> '\n        str = Client.prefix() + '<span class=\"mute\">' + str + msg + '</span>'\n        // str = '<span class=\"QO-line\">' + str + '</span>'\n    Core.printdown(str)\n  }\n  var send  = Core.send\n  \n  var active = false\n  \n  var permitted = [\n   {use: true,  area:'Mhojave Desert'   },\n   {use: true,  area:'Dakhota Hills'    },\n   {use: true,  area:'Dun Valley'       },\n   {use: true,  area:'Vashnar Mountains'},\n   {use: true,  area:'Southern Vashnars'},\n   {use: true,  area:'Pash Valley'      },\n   {use: true,  area:'Siroccian Hills'  },\n   {use: true,  area:'Granite Hills 1'  },\n   {use: true,  area:'Granite Hills 2'  },\n   {use: false, area:'Tundra'           },\n   {use: false, area:'Fissure of Echoes'},\n  ]\n  \n  var terminus =  \"37631\"\n  var list = []\n  \n  var construct = function() {\n    for (var i = 0; i < permitted.length; i++) {\n      var item = permitted[i]\n      if (item.use && typeof prospecting.data[item.area] != 'undefined') {\n        list = list.concat(clone(prospecting.data[item.area]))\n      }\n    }\n    list.push(terminus)\n    print('Generated prospecting list of ' + list.length + ' rooms.')\n  }\n  \n  var goNext = function() {\n    if (!active) {\n      print('Prospecting not active.')\n    }\n    if (list.length === 0) {\n      print('No further prospecting rooms listed.')\n      active = false\n      return\n    }\n    var nextRoom = list.shift()\n    print('Path track to ' + nextRoom + '.')\n    send('path track ' + nextRoom)\n  }\n  \n  return {\n    generate   : construct,\n    permissions: permitted,\n    next       : goNext,\n    print      : print,\n    list       : function() { return list },\n    active     : function(v) { if (typeof v != 'undefined') { active = v } return active },\n  }\n})()"},{"name":"prospecting data","type":"script","id":"QO-edpnc4","output":"prospecting = typeof prospecting != 'undefined' ? prospecting : {}\n\nprospecting.data = {\n  ['Mhojave Desert']: [\n    \"330\", \"331\", \"335\", \"334\", \"333\", \"343\", \"347\", \n    \"348\", \"352\", \"6587\", \"6629\", \"348\", \"45863\", \"344\", \n    \"345\", \"346\", \"350\", \"354\", \"358\", \"357\", \"356\", \n    \"355\", \"1236\", \"1235\", \"1247\", \"1246\", \"1249\", \"1250\", \n    \"1244\", \"1243\", \"1251\", \"1245\", \"1237\", \"316\", \"318\", \n    \"312\", \"311\", \"317\", \"315\", \"310\", \"314\", \"308\", \n    \"307\", \"303\", \"301\", \"309\", \"302\", \"300\", \"304\", \n    \"14790\", \"6164\", \"13778\", \"306\", \"305\"\n  ],\n  ['Dakhota Hills']: [\n    \"1079\", \"1080\", \"1077\", \"1081\", \"1083\", \"1094\", \"1084\", \n    \"1089\", \"1088\", \"1090\", \"1091\", \"1093\", \"1092\", \"1095\", \n    \"1103\", \"1102\", \"1115\", \"1118\", \"1119\", \"1121\", \"1123\", \n    \"1112\", \"1113\", \"1114\", \"1111\", \"1104\", \"1105\", \"1106\", \n    \"1096\", \"1097\", \"1098\", \"1082\", \"1100\", \"1101\", \"1125\", \n    \"1127\", \"1126\", \"1133\", \"1136\", \"1137\", \"1138\", \"1139\", \n    \"1132\", \"1128\", \"1131\", \"1130\", \"1108\", \"1107\"\n  ],\n  ['Dun Valley']: [\n    \"3812\", \"3797\", \"3796\", \"3799\", \"3801\", \"3802\", \"3805\", \n    \"3804\", \"3800\", \"3821\", \"3798\", \"3795\", \"5036\", \"5035\", \n    \"5034\", \"5033\", \"5032\"\n  ],\n  ['Vashnar Mountains']: [\n    \"2019\", \"2018\", \"2017\", \"2010\", \"2011\", \"2012\", \"2013\", \n    \"2015\", \"2016\", \"2014\", \"2009\", \"2008\", \"2007\"\n  ],\n  ['Southern Vashnars']: [\n    \"10226\", \"10247\", \"10224\", \"10502\", \"10381\", \"10458\", \"10241\", \n    \"10295\", \"38162\", \"35601\", \"35193\", \"10280\", \"10311\", \"10235\", \n    \"13553\", \"10342\", \"10299\", \"10250\", \"10448\", \"10218\", \"10219\", \n    \"10429\", \"10412\", \"10567\", \"10203\", \"10202\", \"10195\", \"10712\", \n    \"10196\", \"10194\", \"10240\", \"10184\", \"10186\", \"10182\", \"10185\", \n    \"10189\", \"10193\", \"10187\", \"10192\", \"10190\", \"10409\", \"10181\", \n    \"10206\", \"10222\"\n  ],\n  ['Pash Valley']: [\n    \"1726\", \"1725\", \"1724\", \"1723\", \"1722\", \"1721\", \"1720\", \n    \"1717\", \"1716\", \"1714\", \"5585\", \"4315\", \"1715\", \"1713\", \n    \"1718\", \"1719\", \"1712\", \"1711\", \"1710\", \"1705\", \"1702\", \n    \"1706\", \"1709\", \"1708\", \"1707\", \"1697\", \"1619\", \"1728\", \n    \"1490\", \"1729\", \"1727\", \"1686\", \"1685\", \"1683\", \"1634\", \n    \"1633\", \"1635\", \"1632\", \"1630\", \"1629\", \"1631\", \"1628\", \n    \"1627\", \"1626\", \"1433\", \"1434\", \"1432\", \"1431\", \"1435\",\n    \"1428\", \"1430\", \"1427\", \"1423\", \"1425\", \"1424\", \"1426\", \n    \"1429\", \"3018\", \"3017\", \"3019\", \"3020\", \"3391\", \"3390\", \n    \"3389\", \"28632\", \"3016\", \"3015\", \"2997\", \"2991\", \"2990\", \n    \"2977\"\n  ],\n  ['Siroccian Hills']: [\n    \"2979\", \"2980\", \"2981\", \"3420\", \"3421\", \"3422\", \"3424\", \n    \"3423\", \"2982\", \"2983\", \"2984\", \"2985\", \"2986\", \"2987\", \n    \"2988\"\n  ],\n  ['Granite Hills 1']: [\n    \"9067\", \"9068\", \"9069\", \"9075\", \"9074\", \"9073\", \"9070\", \n    \"9071\", \"9072\", \"9146\", \"19004\", \"11693\", \"11657\", \"18634\",\n    \"7626\", \"7154\", \"7153\", \"7155\", \"7156\", \"7226\", \"7625\", \n    \"9139\", \"9140\", \"9141\", \"9142\", \"9143\", \"9144\", \"9145\"\n  ],\n  ['Granite Hills 2']: [\n    \"9086\", \"9088\", \"9089\", \"9090\", \"9091\", \"9092\", \"9093\", \n    \"9096\", \"9094\", \"9095\", \"9138\", \"9147\", \"9097\", \"9098\", \n    \"9099\", \"9100\", \"9101\", \"9102\", \"9103\", \"9131\", \"9130\", \n    \"9105\", \"9104\"\n  ],\n  ['Tundra']: [\n    \"10832\", \"10866\", \"10833\", \"10836\", \"10835\", \"10906\", \"10922\", \n    \"10923\", \"10924\", \"11049\", \"10891\", \"10892\", \"10894\", \"10896\", \n    \"10893\", \"10897\", \"10898\", \"10901\", \"10907\", \"13931\", \"10909\", \n    \"10911\", \"13934\" ,\"10912\", \"14104\", \"10914\", \"10915\"\n  ],\n  ['Fissure of Echoes']: [\n    \"27613\", \"25555\", \"25027\", \"23720\", \"23052\", \"21114\", \"20259\", \n    \"18933\", \"16024\", \"15775\", \"15756\",\n  ]\n}"},{"name":"+pg, prospect generate","type":"alias","id":"QO-q3kwtk","patterns":["^\\+pg$"],"output":"prospecting.generate()"},{"name":"+pn, prospect next","type":"alias","id":"QO-r7i4vy","patterns":["^\\+pn$"],"output":"prospecting.active(true)\nprospecting.next()"},{"name":"lode+","type":"trigger","id":"QO-aaes43","patterns":["^You determine that there is a (\\w+) lode of (.*) here."],"output":"console.log(matches)"},{"name":"mine+","type":"trigger","id":"QO-of9549","patterns":["^There is a (\\w+) (.*) mine here on a (\\w+) lode that you'd guess is approximately (\\w+)% mined out\\.$"],"output":"console.log(matches)"},{"name":"stronghold+","type":"trigger","id":"QO-w91lrb","patterns":["This stronghold is controlled by (\\w+)\\."],"output":"console.log(matches)"},{"name":"mine owner+","type":"trigger","id":"QO-bc7t0e","patterns":["This (.+?) mine is owned by (\\w+)\\."],"output":"console.log(matches)"},{"name":"partial+","type":"trigger","id":"QO-e5acto","patterns":["^You determine that there is a (\\w+) lode of (.*) here\\. Approximately (.*)% has been mined\\."],"output":"console.log(matches)"},{"name":"arrival+","type":"trigger","id":"QO-swvhem","patterns":["^You have arrived at your destination!$"],"output":"if (prospecting.active()) {\n  Core.send('prospect')\n  Core.send('read sign')\n}"},{"name":"no lode+","type":"trigger","id":"QO-kogibp","patterns":["^You are enough of a prospector to realise there is no lode here and no point looking for one\\.$","^There are no lodes to be found within the mining camp proper\\.$"],"output":"if (prospecting.active()) {\n  var list = prospecting.list()\n  \n  prospecting.print('<span class=\"darkred\">' + list.length + '</span> rooms left.')\n  \n  setTimeout(function() {\n    prospecting.next()\n  }, 1100)\n}"},{"name":"traversal, in progress","type":"trigger","id":"QO-v30bil","patterns":["^You are already traversing to a location. If you wish to cancel your movement, please CLICK HERE\\.$"],"output":""},{"name":"walking error+","type":"trigger","id":"QO-m9adw6","patterns":["^You are already there!$"],"output":"if (prospecting.active()) {\n  Core.send('prospect')\n  Core.send('read sign')\n}"}]},{"name":"arrived, shipwreck","type":"trigger","id":"QO-y2mdy5","patterns":["^You step into a small boat, which is lowered to the water and rowed to (Floating ship wreckage) by a pair of burly oarsmen\\. After you disembark, the rowboat returns to the windcutter, which sets sail in the direction from whence you came\\.$"],"output":""}]}]